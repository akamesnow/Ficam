[POST_VERSION] #DO NOT MOVE OR ALTER THIS LINE# V24.00 P0 E1 W24.00 T1563779228 M24.00 I0 O0
#version PP 1.0.0.2
#[STARTBIN]
#property of ficam, Eric Dauvilliers, e.dauvilliers@ficam.com, +33 (0)2 37 26 28 10
# exclusivement pour machine a portique...

#region FS
fs  1  1.9lt        # Format avec toute la precision pour les variable internes de mp
fs  2  1^3l        # frormat d'affichage a 3 chifres max pour les variables affichÃƒÆ’Ã‚Â©es
fs  3  1^3ln       # idem mais non modale
fs  4  1 0      # 1 chiffre mini avant virgule  pas de virgule pas de chiffre apres
fs  5  1 0n     # idem mais non modale
fs  6  4 0ln        # 4 chiffres avant pas de virgule pas de chiffre apres non modal force 0 de tete
fs  7  1 3t     # 1 chiffre mini avant virgule  pas de virgule 3 apres force 0 de queue non modal.
fs  8  1.3ln        # 1 chiffre avant la vigule met . 3 chiffres apres virgule non modal force 0 de tete
fs  9  1 0n     # pour liste outil
fs  10 1.3n     # pour liste outil
fs  11 +1^3li       # force 1 chiffre avant virgule met . 3 chiffres apres virgule en incremental
fs  12 +1^3lni
fs  13 3 0ln
fs  14 1.4lt
fs  15 1^3n     # pour liste outil
fs  16 1^3l
fs  17 1.5ln
fs  18 +1^4ln
fs  19 1^3l
#endregion

#region AFFECTATION VARIABLES
fmt 2 avanceG0
fmt 2 old_fr_pos
old_fr_pos : 0
fmt "SAUT" 2 saut_out
fmt "R4=" 2 Vec_X_Renvois
fmt "R5=" 2 Vec_Y_Renvois
fmt "R6=" 2 Vec_Z_Renvois
fmt "R1=" 2 X_absrenvois
fmt "R2=" 2 Y_absrenvois
fmt "R3=" 2 Z_absrenvois
fmt "z" 15 point_vect
fmt " " 15 lg_vect_Z
fmt " " 15 m7_inter
fmt " " 15 m8_inter
fmt " " 15 m9_inter
fmt " " 15 m7_ori
fmt " " 15 m8_ori
fmt " " 15 m9_ori
fmt " " 15 ax
fmt " " 15 ay
fmt 1 tete_renvois
fmt 1 sort_pdrill
fmt 1 first_hole
fmt 1 safety_zone
fmt 1 retournement_OK
fmt 1 verif_bute
fmt 1 freinC
fmt 1 ffreinB
fmt 1 use_name_tool
fmt 1 type_stock
fmt 2 old_op5X
fmt 2 old_ss
fmt 4 speed_tar
fmt 4 dir_tar
fmt 1 old_xform_opid
fmt 1 old_m7
fmt 1 old_m8
fmt 1 old_m9
fmt "D" 5 tloffno$
fmt "h" 5 tlngno$
fmt "" 1 return
fmt  "" 2 sweep$
fmt 2 tox4$
fmt 2 toy4$
fmt 2 toz4$
fmt "X" 2 old_tox4
fmt "Y" 2 old_toy4
fmt "Z" 2 old_toz4
fmt 1 mode_deg
fmt 1 debut_5X
fmt 1 xdep
fmt 1 ydep
fmt 1 zdep
fmt "R" 3 arcrad$
fmt 1 tourne
fmt 1 Idep
fmt 1 Jdep
fmt "X" 2 x_tourne
fmt "Y" 2 y_tourne
fmt "Z" 2 z_tourne
fmt "I" 2 i_tourne
fmt "J" 2 j_tourne
fmt "Z" 2 depth$
fmt "X" 2 x$
fmt "Y" 2 y$
fmt "Z" 2 z$
fmt "I" 2 i$
fmt "J" 2 j$
fmt "X" 2 xdegage_butee
fmt "Y" 2 ydegage_butee
fmt "Z" 2 zdegage_butee
fmt "X" 2 degagex
fmt "Y" 2 degagey
fmt "Z" 2 degagez
fmt "R" 2 refht$
fmt "Z" 2 initht$
fmt "VX" 2 vx
fmt "VY" 2 vy
fmt "VZ" 2 vz
fmt "C" 2 axec
fmt "B" 2 axeab
fmt "longvec" 2 longvec
fmt "X" 2 xabs
fmt "Y" 2 yabs
fmt "Z" 2 zabs
fmt "X" 2 xr$
fmt "Y" 2 yr$
fmt "Z" 2 zr$
fmt "N" 4 n$
fmt "T"  5 t$ 
fmt "T" 5 next_tool$
fmt  "F" 4 fr_pos$
fmt 4 av_travail
fmt 4 av_plonge
fmt 4 av_retract
fmt  "S" 4 ss$
fmt "" 3 xmin
fmt "" 3 ymin
fmt "" 3 zmin
fmt "" 3 xmax
fmt "" 3 ymax
fmt "" 3 zmax
fmt 2 stck_thck$
fmt 2 stck_wdth$
fmt 2 stck_ht$
fmt 4 old_op_id
fmt "OPERATION #" 4 numop
fmt "" 4 mi1$
fmt "SEQ" 4 mi1_2
fmt "X1=" 1 x1
fmt "X2=" 1 x2
fmt "Y1=" 1 y1
fmt "Y2=" 1 y2
fmt "Z1=" 1 z1
fmt "Z2=" 1 z2
fmt 2 angle_X
fmt 2 angle_Z0
fmt 2 angle_Z1
fmt 2 C_plan
fmt 2 B_plan
fmt 2 angle_autour_X
fmt 2 angle_autour_Y
fmt 2 angle_autour_Z
fmt "X=" 2 angle_autour_X2
fmt "" 2 angle_autour_Y2
fmt "Z=" 2 angle_autour_Z2
fmt "Y=" 2 angle_autour_Zp
fmt "" 2 old_angle_autour_X
fmt "" 2 old_angle_autour_Y
fmt "" 2 old_angle_autour_Z
fmt "" 2 angle_autour_X_2
fmt "" 2 angle_autour_Y_2
fmt "" 2 angle_autour_Z_2
fmt "" 2 cos_angleY
fmt "" 2 tr_x
fmt "" 2 tr_y
fmt "X tourne=" 1 New_x_tourne
fmt "Y tourne=" 1 New_y_tourne
fmt 2 rtcp
fmt 2 orig
fmt 2 percage_5x
fmt 2 usinage_5x
fmt  "" 19 bq200
fmt  "" 19 bq201
fmt  "" 3 bq202
fmt  "" 3 bq203
fmt  "" 3 bq204
fmt  "" 3 bq205
fmt  "" 4 avance_al
fmt  "F" 4 bq206
fmt  "" 4 bq208
fmt  "" 8 bq210
fmt  "P" 8 bq211
fmt  "" 3 bq212
fmt  "" 5 bq213
fmt  "" 2 bq214
fmt  "" 8 bq239
fmt  "" 3 bq256
fmt  "" 3 bq257
fmt  "" 3 bq258
fmt  "" 3 bq259
fmt  "" 3 bq336
fmt 3 old_bq200
fmt 3 old_bq201
fmt "long_OA=" 1 long_OA
fmt "long_OB=" 1 long_OB
fmt "long_OC=" 1 long_OC
fmt "long_AB=" 1 long_AB
fmt "long_AC=" 1 long_AC
fmt "long_CB=" 1 long_CB
fmt "Angle A=" 1 angle_a
fmt "Angle B=" 1 angle_b
fmt "Angle C=" 1 angle_c
fmt "Cos Angle A=" 1 cosangle_a
fmt "Cos Angle B=" 1 cosangle_b
fmt "Cos Angle C=" 1 cosangle_c
fmt " produitAA =" 1 produitAA
fmt " produitBB =" 1 produitBB
fmt " produitCC =" 1 produitCC
fmt "P base=" 1 produit_p_base
fmt "C base=" 1 C_angle_base
fmt "sin_C_base=" 1 C_angle_base_sin
fmt "cos_C_base=" 1 C_angle_base_cos
fmt "P souhaiter=" 1 produit_p_souhaite
fmt "C souhaiter=" 1 C_angle_souhaite
fmt "sin_C_souhaiter=" 1 C_angle_souhaiter_sin
fmt "cos_C_souhaiter=" 1 C_angle_souhaiter_cos
fmt "C=" 1 C_rotation
fmt "C reel=" 1 C_angle_reel
fmt "C reel droit=" 1 C_angle_reel_droite
fmt "C reel gauche=" 1 C_angle_reel_gauche
fmt "P pour B=" 1 produit_p_B
fmt "sin_B_souhaiter=" 1 B_angle_sin
fmt "cos_B_souhaiter=" 1 B_angle_cos
fmt "B=" 1 B_rotation
fmt "Polarite=" 4 polarite_axe
fmt "" 1 changpolar_C
fmt "" 1 change_polar
fmt "Vecteur porteur X=" 1 Vect_porteur_x
fmt "Vecteur porteur Y=" 1 Vect_porteur_y
fmt "Vecteur porteur Z=" 1 Vect_porteur_z
fmt "angle entre repere et axe B=" 1 angle_axeB
fmt "angle entre repere et axe outil=" 1 angle_axe_outil
fmt "diff angle=" 1 dif_angle_B_outil
fmt "sens de rotation 1 pour inverser et  0 pour normal  =" 1 sens_axe_outil
fmt "TX" 1 tx
fmt "TY" 1 ty
fmt "TZ" 1 tz
fmt "TX" 1 old_tx
fmt "TY" 1 old_ty
fmt "TZ" 1 old_tz
fmt "X" 2 old_x
fmt "Y" 2 old_y
fmt "Z" 2 old_z
fmt "C" 2 axe_C_cal
fmt "C" 2 axec_reel
fmt "B" 2 axeab_reel
fmt "C" 2 axec_degage_butee
fmt "B" 2 axeab_degage_butee
fmt "C" 2 old_axec_reel
fmt "C" 2 old_axec_cal
fmt "B" 2 old_axeab_reel
fmt 1 xplan_inter
fmt 1 yplan_inter
fmt 1 zplan_inter
fmt "X" 2 xplan
fmt "Y" 2 yplan
fmt "Z" 2 zplan
fmt "Z" 2 old_zplan
fmt 1 lub
fmt 2 coolant$
fmt 2 spdir$
fmt 2 delta_axeC
fmt 1 nb_tour
fmt 3 old_spdir
fmt "R" 1 result
fmt 2 maxiab
fmt 2 miniab
fmt 2 maxic
fmt 2 minic
fmt 2 erreur
fmt 2 autre_solution
fmt 2 use_retract_plane
fmt 2 use_secu_start_end
fmt 2 use_secu_plane
fmt 2 feed_plane
fmt 2 retract_plane
fmt 2 secu_plane
fmt 2 garde_plane
fmt 2 vecteur_degage
fmt 2 avance_param
fmt 2 combinaison_axes
fmt 2 gestion_rotation
fmt 2 use_plane_spacial
fmt 2 type_machine
fmt 2 cycl32
fmt 1 m1
fmt 1 m2
fmt 1 m3
fmt 1 m4
fmt 1 m5
fmt 1 m6
fmt 1 m7
fmt 1 m8
fmt 1 m9
fmt 2 use_fmax_plane
fmt 2 degage_butee
fmt "X=" 2 vec_perc_X
fmt "Y=" 2 vec_perc_Y
fmt "Z=" 2 vec_perc_Z
fmt "" 2 Lg_vec_per
fmt "X" 2 surf_piece_X
fmt "Y" 2 surf_piece_Y
fmt "Z" 2 surf_piece_Z
fmt "X" 2 plan_secu_X
fmt "Y" 2 plan_secu_Y
fmt "Z" 2 plan_secu_Z
fmt "Z" 2 plan_secu_end_Z
fmt "X" 2 plan_retract_X
fmt "Y" 2 plan_retract_Y
fmt "Z" 2 plan_retract_Z
fmt "X" 2 plan_garde_X
fmt "Y" 2 plan_garde_Y
fmt "Z" 2 plan_garde_Z
fmt "X" 2 drl_depth_x$
fmt "Y" 2 drl_depth_y$
fmt "Z" 2 drl_depth_z$
fmt "X" 2 drl_depth_xplan
fmt "Y" 2 drl_depth_yplan
fmt "Z" 2 drl_depth_zplan
fmt 1 old_tool_op

V_newX : 0	
V_newY : 0
V_newZ : 0	

Vold_newX : 0	
Vold_newY : 0
Vold_newZ : 0

fmt "cos =" 1 pscla
fmt "angle: " 1 ang
#endregion

#region FQ
fmt 2 mr1$
fq 1 mr1$ "VALEUR DE DEGAGEMENT VECTORIELLE?"

#endregion

#region VALEURS PAR DEFAUT

saut_out : 1
tete_renvois : no$
etournement_OK : no$
verif_bute : no$
nb_tour : 0
old_op5X : 0
bug1$     : 5
conteur_string : 0
old_op_id : 999
ss$ = abs(ss$)
numop : 1
percage_5x = 0 # en contante cpr
usinage_5x : 0
Vect_porteur_x :  0
Vect_porteur_y :  0
Vect_porteur_z :  1
changpolar_C : 1
polarite_axe : 1
degagex : 0
degagey : 0
degagez : 0
lub : 0
old_tox4 : 0
old_toy4 : 0
old_toz4 : 0
old_angle_autour_X : 99999.99
old_angle_autour_Y : 99999.99
old_angle_autour_Z : 99999.99
x$ : 99999.99
y$ : 99999.99
z$ : 99999.99
i$ : 99999.99
j$ : 99999.99
sweep$ : 99999.99
tox4$ : 99999.99
toy4$ : 99999.99
toz4$ : 99999.99
arcrad$ : 99999.99
refht$ : 99999.99
initht$ : 99999.99
xr$ : 99999.99
yr$ : 99999.99
zr$ : 99999.99
change_polar : -1
old_axec_reel : 0
old_axeab_reel : 0
delta_axeC : 0
erreur : 0
autre_solution : 0
avance_param : -1
cycl32 : 0
use_fmax_plane : 1
subprg$    : yes$
mergesub$  : 0
degage_butee : 0
freinC : 0
freinB : 0
#endregion

#region simulation
fmt "la string commence a:" 4 conteur_string
fmt 1 simu
simu : 0
sextsub$ : ".ini"
snom : ""
snom_ini : ""
spathnc_original : ""
sous_chaine : "appdata\local\temp"
sdllMachSim : "C:\Program Files\Mastercam 2022\Mastercam\chooks\Simulation_FICAM.dll" # pour debug cedric
#sdllMachSim : "C:\Program Files\Mastercam 2020\Mastercam\chooks\Simulation_FICAM.dll"
psimulation
	spathnc_original = spathnc$
	conteur_string = scan(sous_chaine,spathnc_original)
	if st_str_ix$, simu = 1
	if simu = 1,	
    [
        spathsub$ = spathpst$
        snamesub$ = snom_ini
        #"voir" , snom_ini ,e$
        subout$ = 1
        snom = spathnc$ + snamenc$ + sextnc$
        #"KEY=38289F3240I00C00A0000",e$
        #"KEY=38271F3240I00C00A0000",e$
        "KEY=966525F6096I00C00A0000",e$
        "REP =", *snom, e$
        "USE_OTHER_NC_FILE = NO" ,e$
        "[SHIFT ORIGIN BETWEEN MACHSIM TO REALITY]" ,e$
        "X = 0" ,e$
        "Y = 0" ,e$
        "Z = 1200" ,e$

        "[DOT TO DISPLAY MACHSIM]" ,e$
        "X = 0" ,e$
        "Y = 0" ,e$
        "Z = 1200" ,e$

        "[MACHINE_DEF]" ,e$
        #;FANUC HEID ect...
        "CONTROL_TYPE = OSAI" ,e$
        #;radius ;delta_start_to_center ;delta_center_to_start; signed_radius
        "ARC_TYPE = delta_start_to_center",e$
        "COMMENT = (DIS|" ,e$
        ";VARIABLE = #" ,e$
        "FEED_MAX= 50000" ,e$
        "COORD_MACH = G79|G53" ,e$

        "[PLANE_TYPE]" ,e$
        #(UPR,0,XYZ,0.,0.,0,0,0,0)
        #(UPR,1,XYZ,0,0.,0.)
        #"PLANE_ON = (UPR|0|XYZ|0.|0.|ROTZ|SHIFTXabs|SHIFTYabs|SHIFTZabs)|next_line|(UPR|1|XYZ|ROTX|0.|0.)|" ,e$
		#"PLANE_ON = (UPR|0|XYZ|ROTX|ROTY|ROTZ|SHIFTXabs|SHIFTYabs|SHIFTZabs|" ,e$
        "PLANE_ON = (UPR|0|XYZ|0.|0.|ROTZ|SHIFTXabs|SHIFTYabs|SHIFTZabs|next_line|(UPR|1|XYZ|ROTX|0.|0.)|" ,e$
		#"PLANE_ON = G68.2|P1|SHIFTXabs|SHIFTYabs|SHIFTZabs|ROTX|ROTY|ROTZ|" ,e$
        "PLANE_OFF = (UPR)" ,e$

        #";SHIFT_ON = CYCL DEF 7.0| POINT ZERO|next_line|CYCL |DEF |7.1|SHIFTXabs|next_line|CYCL |DEF |7.2| SHIFTYabs |next_line|CYCL |DEF |7.3| SHIFTZabs|" ,e$
        "SHIFT_ON = G52|SHIFTXabs|SHIFTYabs|SHIFTZabs|" ,e$
        ";SHIFT_OFF = G69 ",e$

        ";ROT_ON = G68|AXE|ROT|" ,e$
        ";ROT_OFF = G69" ,e$

        "RTCP_ON = (TCP,1)" ,e$
        "RTCP_OFF = (TCP)" ,e$

        ";TOOL_ON = G43" ,e$
        ";TOOL_OFF = G49 ",e$

        "[DRILL_CYCLE]" ,e$
        #; si on est sur un type CYCLE81 () siemens indiquer la position de la valeur dans le cycle ... pas besoin de definir pour HEID car toujour identique
        "DRILL_ON_CYCLE = YES" ,e$
        "CALL_CYCLE = G81|G83|G73|G74|G84" ,e$
        "SECU_PLANE_ABS = OLD_Z" ,e$
        ";SECU_PLANE_RELATIV = OLD_Z" ,e$
        ";PROF_RELATIV = Z" ,e$
        "PROF_ABS = Z" ,e$
        ";RETRACT_RELATIV = R" ,e$
        "RETRACT_ABS = R",e$
        "AVANCE = F" ,e$
        "PECK = Q X 1" ,e$
        "CYCLE_OFF = G80" ,e$

        "[NOT READ]" ,e$
        "G53.1" ,e$
        #"G0 G28 G91" ,e$

        "[MACRO] (attention pas MACHMOVE avec axes XYZABC)" ,e$

        "{M6}" ,e$
        "G0 G79 Z0" ,e$
        "G0 G79 Z-100 B-90" ,e$
		"G0 G79 X1670.0" ,e$ 
		"MW_MACHMOVE SUBMOVE RAPID _CCHANGEUR90", e$
		"MW_MACHMOVE SUBMOVE RAPID _ZCHANGEUR268",e$
		#"MW_MACHMOVE SUBMOVE RAPID _YCHANGEUR-444.028", e$
		"G0 G79 Z-30" ,e$
		#"MW_MACHMOVE SUBMOVE RAPID _CCHANGEUR22.5", e$
		"display_tool" ,e$
		"G0 G79 Z-100" ,e$
		"MW_MACHMOVE SUBMOVE RAPID _ZCHANGEUR0",e$
		"G0 G79 Z0 C0 B0" ,e$
		"MW_MACHMOVE SUBMOVE RAPID _CCHANGEUR0", e$
        #"G0 G79 X0 Y0 Z-150 ",e$
        
        #"G0 G79 X0 Y0 Z-150 ",e$
        #"G0 G79 X0 Y0 Z-1" ,e$

        "{FIN}" ,e$

        subout$ = 0
    ]
fmt "X" 1 angle_autour_X_RUD
fmt "Y" 1 angle_autour_Y_RUD
fmt "Z" 1 angle_autour_Z_RUD

fmt 1 m1_RUD
fmt 1 m2_RUD
fmt 1 m3_RUD
fmt 1 m4_RUD
fmt 1 m5_RUD
fmt 1 m6_RUD
fmt 1 m7_RUD
fmt 1 m8_RUD
fmt 1 m9_RUD

fmt 1 m1_RUDA
fmt 1 m2_RUDA
fmt 1 m3_RUDA
fmt 1 m4_RUDA
fmt 1 m5_RUDA
fmt 1 m6_RUDA
fmt 1 m7_RUDA
fmt 1 m8_RUDA
fmt 1 m9_RUDA

fmt 1 m1_RUDB
fmt 1 m2_RUDB
fmt 1 m3_RUDB
fmt 1 m4_RUDB
fmt 1 m5_RUDB
fmt 1 m6_RUDB
fmt 1 m7_RUDB
fmt 1 m8_RUDB
fmt 1 m9_RUDB

fmt 1 Lg_X	
fmt 1 Lg_Y
fmt 1 Lg_Z	
precal_new_matrice_RUD
	#vois comment le rud a tourner
	if t_wcs_m1$ <> 1 | t_wcs_m5$ <> 1 | t_wcs_m9$ <> 1,
	[
    	angle_autour_Y_RUD = asin (t_wcs_m3$)
    	cos_angleY = cos (angle_autour_Y_RUD)
   	 	angle_autour_Y_RUD = angle_autour_Y_RUD *-1
   	 	if cos_angleY > 0.005 , 
		[
			#3 angle autour de X    
			tr_x = t_wcs_m9$ / cos_angleY
			tr_y = -t_wcs_m6$ / cos_angleY
			angle_autour_X_RUD = atan2 (tr_y,tr_x)

			angle_autour_X_RUD = angle_autour_X_RUD * -1
			#4 angle autour de Z
			tr_x = t_wcs_m1$ / cos_angleY
			tr_y = -t_wcs_m2$ / cos_angleY
			angle_autour_Z_RUD  = atan2 (tr_y,tr_x)
			angle_autour_Z_RUD = angle_autour_Z_RUD * -1
		]
   	 	else,   
		[
			# angle autour de X
			angle_autour_X_RUD  = 0
			# angle autour de Z
			angle_autour_Z_RUD = atan2 (t_wcs_m4$,t_wcs_m5$)
			angle_autour_Z_RUD = angle_autour_Z_RUD * -1

		]
 
		#tourne X autour Z :
		m1_RUDA = m2$  * sin(angle_autour_Z_RUD) + m1$  * cos(angle_autour_Z_RUD)
    	m2_RUDA = m2$  * cos(angle_autour_Z_RUD) - m1$  * sin(angle_autour_Z_RUD)

		#tourne X autour Y :
		m3_RUDA = m1_RUDA * sin(angle_autour_Y_RUD) + m3$ * cos(angle_autour_Y_RUD)
		m1_RUDB = m1_RUDA * cos(angle_autour_Y_RUD) - m3$  * sin(angle_autour_Y_RUD)
	
		#tourne X autour X :
		m2_RUDB = m3_RUDA * sin(angle_autour_X_RUD) + m2_RUDA  * cos(angle_autour_X_RUD)
		m3_RUDB = m3_RUDA * cos(angle_autour_X_RUD) - m2_RUDA  * sin(angle_autour_X_RUD)
	
		#tourne Y autour Z :
		m4_RUDA = m5$  * sin(angle_autour_Z_RUD) + m4$  * cos(angle_autour_Z_RUD)
    	m5_RUDA = m5$  * cos(angle_autour_Z_RUD) - m4$  * sin(angle_autour_Z_RUD)

		#tourne Y autour Y :
		m6_RUDA = m4_RUDA * sin(angle_autour_Y_RUD) + m6$ * cos(angle_autour_Y_RUD)
		m4_RUDB = m4_RUDA * cos(angle_autour_Y_RUD) - m6$  * sin(angle_autour_Y_RUD)
	
		#tourne Y autour X :
		m5_RUDB = m6_RUDA * sin(angle_autour_X_RUD) + m5_RUDA  * cos(angle_autour_X_RUD)
		m6_RUDB = m6_RUDA * cos(angle_autour_X_RUD) - m5_RUDA  * sin(angle_autour_X_RUD)
	
		#tourne Z autour Z :
		m7_RUDA = m8$  * sin(angle_autour_Z_RUD) + m7$  * cos(angle_autour_Z_RUD)
    	m8_RUDA = m8$  * cos(angle_autour_Z_RUD) - m7$  * sin(angle_autour_Z_RUD)

		#tourne Z autour Y :
		m9_RUDA = m7_RUDA * sin(angle_autour_Y_RUD) + m9$ * cos(angle_autour_Y_RUD)
		m7_RUDB = m7_RUDA * cos(angle_autour_Y_RUD) - m9$  * sin(angle_autour_Y_RUD)
	
		#tourne Z autour X :
		m8_RUDB = m9_RUDA * sin(angle_autour_X_RUD) + m8_RUDA  * cos(angle_autour_X_RUD)
		m9_RUDB = m9_RUDA * cos(angle_autour_X_RUD) - m8_RUDA  * sin(angle_autour_X_RUD)
	
		Lg_X = sqrt(m1_RUDB^2+m2_RUDB^2+m3_RUDB^2)
		m1$ = m1_RUDB / Lg_X
		m2$ = m2_RUDB / Lg_X
		m3$ = m3_RUDB / Lg_X
		Lg_Y = sqrt(m4_RUDB^2+m5_RUDB^2+m6_RUDB^2)
		m4$ = m4_RUDB / Lg_Y
		m5$ = m5_RUDB / Lg_Y
		m6$ = m6_RUDB / Lg_Y
		Lg_Z = sqrt(m7_RUDB^2+m8_RUDB^2+m9_RUDB^2)
		m7$ = m7_RUDB / Lg_Z
		m8$ = m8_RUDB / Lg_Z
		m9$ = m9_RUDB / Lg_Z
		# calcul de dec abs
		x1 = toy4$  * sin(angle_autour_Z_RUD) + tox4$ * cos(angle_autour_Z_RUD)
    	y1 = toy4$  * cos(angle_autour_Z_RUD) - tox4$ * sin(angle_autour_Z_RUD)
		
		z1 = x1 * sin(angle_autour_Y_RUD) + toz4$ * cos(angle_autour_Y_RUD)
    	xplan = x1 * cos(angle_autour_Y_RUD) - toz4$  * sin(angle_autour_Y_RUD)
		
		yplan = z1 * sin(angle_autour_X_RUD) + y1 * cos(angle_autour_X_RUD)
    	zplan = z1 * cos(angle_autour_X_RUD) - y1 * sin(angle_autour_X_RUD)	

		tox4$ = (xplan - t_orgin_x$)
		toy4$ = (yplan - t_orgin_y$)
		toz4$ = (zplan - t_orgin_z$)
	]
ppost$       # traitement apres post pro pour effacer le fichier OPS et renommer le fichier NC
    if simu = 1,
    [
        result = dll(sdllMachSim,spathnc$)
    ]
#endregion

#region DECLARATION STRING
smachine : ""
slettrea : "A"
slettreb : "B"
slettrec : "C"
srot : "AROT"
sluboff: ""
sarret_optionnel : "M1"
sannul_plan : "(UPR)"
sannul_Dec : " TRANS X0 Y0 Z0"
sm99 : "MCALL"
smode_deg : "G79" #"G79 D0"
sc00 : "G40"
sc01 : "G41"
sc02 : "G42"
splane_spacial : "AROT"
splane_reset_turn : "(UPR)"
splane_reset_stay : "(UPR)"
serreur_visu : ""
serreuraxeab_1 : " -  ATTENTION ARRET POST-PRO : L axe B sort de ses limites de "
serreuraxeC : " -  ATTENTION ARRET POST-PRO : L axe C sort de ses limites de "
serreuraxeab_2 : ", aucune solution trouve, veuillez modifier le parcours L USINAGE #"
schange_polar : "ATTENTION Changement de polarite suite bute axe B "
sretournement : "RETOURNEMENT DETECTE A L USINAGE #"
sbutee1 : "UTILISATION DES BUTEES MACHINE GAUCHE"
sbutee2 : "UTILISATION DES BUTEES MACHINE DROITE"
sg00 : "G0"
sg01 : "G1"
sg02 : "G2"
sg03 : "G3"
sq04 : "G4"
sg05 : "G80"
sgcode : ""
fstrsel sg00 gcode$ sgcode 6 -1

sm00 : "M4"
sm01 : "M5"
sm02 : "M3"
spdlon : ""
spdlsel = fsg3(spdir$)
fstrsel  sm00 spdlsel spdlon 3 -1

sp00 : ""
sp01 : ""
spolar : ""
fstrsel sp00 mi1_2 spolar 2 -1

sr00 : "(TCP)"
sr01 : "(TCP,1)"
srtcp : ""
fstrsel sr00 rtcp srtcp 2 -1

so00 : "(UIO,X(-$PRPUX(1,1)),Z($PRPUZ(1,1)))"
so01 : "(UIO,X($PRPUX(1,1)),Z(-($PRPUZ(1,1))))"
sorig : ""
fstrsel so00 orig sorig 2 -1

stck00 : "BOX"
stck01 : "CYLINDER"
stck_type : ""
fstrsel stck00 type_stock stck_type 2 -1

sfreinC00 : "M33 ;Debloquer Axe C"
sfreinC01 : "M34 ;Bloquer Axe C"
sfreinC : ""
fstrsel sfreinC00 freinC sfreinC 2 -1

sfreinB00 :"M31 ;Debloquer Axe B"
sfreinB01 :"M32 ;Bloquer Axe B"
sfreinB : ""
fstrsel sfreinB00 freinB sfreinB 2 -1

pcorrection

	if cc$ = 41, sc01
    if cc$ = 42, sc02
    if cc$ = 140, sc00

#endregion

#region CALCUL
pcalcul_block_form
    if stck_crnr$ = 0,  
	[
		xmin = stck_x$ - (stck_ht$ / 2)
		ymin = stck_y$ - (stck_wdth$ / 2)
		xmax = stck_x$ + (stck_ht$ / 2)
		ymax = stck_y$ + (stck_wdth$ / 2)
	]
    if stck_crnr$ = 1 | stck_crnr$ = 5, 
	[
		xmin = stck_x$
		ymin = stck_y$ - stck_wdth$
		xmax = stck_x$ + stck_ht$
		ymax = stck_y$
	]
    if stck_crnr$ = 2 | stck_crnr$ = 6, 
	[
		xmin = stck_x$ - stck_ht$
		ymin = stck_y$ - stck_wdth$
		xmax = stck_x$
		ymax = stck_y$
	]
    if stck_crnr$ = 3 | stck_crnr$ = 7, 
	[
		xmin = stck_x$ - stck_ht$
		ymin = stck_y$
		xmax = stck_x$
		ymax = stck_y$ + stck_wdth$
	]
    if stck_crnr$ = 4 | stck_crnr$ = 8, 
	[
		xmin = stck_x$
		ymin = stck_y$
		xmax = stck_x$ + stck_ht$
		ymax = stck_y$ + stck_wdth$
	]
    if stck_crnr$ < 5,  
	[
		zmin = stck_z$ - stck_thck$
		zmax = stck_z$
	]
    else,   
	[
		zmin = stck_z$
		zmax = stck_z$ + stck_thck$
	]
pnumop      # numerotation des operations post-processees
    !old_op_id
    if op_id$ <> old_op_id,    
	[
		numop = numop + 1
		if old_tool_op <> 154, debut_5X = 0
	]
compteur_op : 0
fmt "N" 2 compteur_op	
pjump
		spaces$ = 0
		compteur_op = compteur_op + 1
		" ", e$
		n$, 34, *compteur_op,34, e$
		n$, "#SC0.4=", 34, *compteur_op, 34, e$
		spaces$ = 1	
pcalcul_plan
    old_angle_autour_X = angle_autour_X
    old_angle_autour_Y = angle_autour_Y
    old_angle_autour_Z = angle_autour_Z
    angle_autour_Y = asin (m3$)
    cos_angleY = cos (angle_autour_Y)
    angle_autour_Y = angle_autour_Y *-1
    if cos_angleY > 0.005 ,
    [
        #3 angle autour de X
        tr_x = m9$ / cos_angleY
        tr_y = -m6$ / cos_angleY
        angle_autour_X  = atan2 (tr_y,tr_x)
        if angle_autour_X > 180 , angle_autour_X = angle_autour_X - 360
        angle_autour_X = angle_autour_X * -1
        #4 angle autour de Z
        tr_x = m1$ / cos_angleY
        tr_y = -m2$ / cos_angleY
        angle_autour_Z  = atan2 (tr_y,tr_x)
        if angle_autour_Z > 180 , angle_autour_Z = angle_autour_Z - 360
        angle_autour_Z = angle_autour_Z * -1
    ]
    else,
    [
        # angle autour de X
        angle_autour_X  = 0
        # angle autour de Z
        angle_autour_Z  = atan2 (m4$,m5$)
        if angle_autour_Z > 180 , angle_autour_Z = angle_autour_Z - 360
        angle_autour_Z = angle_autour_Z * -1
    ]
	#"voir" , *angle_autour_X ," et :" , *angle_autour_Y , "et :" ,*angle_autour_Z ,e$ 
	if m9$ < 1,
	[
		if m9$ > -1,
		[
			angle_autour_Zp = (atan2(m3$,m6$)) *  -1
			angle_autour_X2 = acos(m9$)
			angle_autour_Z2 = atan2(m7$,-m8$)
		]
		else,
		[
			angle_autour_X2 = 180
			angle_autour_Z2 = (atan2(-m2$,m1$)) *-1
			angle_autour_Zp = 0
		]
	]
	else,
	[
		angle_autour_Zp = 0
		angle_autour_X2 = 0
		angle_autour_Z2 = 0
	]
pcalcul_tourne
	#angle_autour_Zp = 0
	if angle_autour_Zp  <> 0,
	[
    	X_tourne = ydep  * sin(angle_autour_Zp) + xdep  * cos(angle_autour_Zp)
    	Y_tourne = ydep  * cos(angle_autour_Zp) - xdep * sin(angle_autour_Zp)
		i_tourne = Jdep  * sin(angle_autour_Zp) + Idep  * cos(angle_autour_Zp)
    	j_tourne = Jdep  * cos(angle_autour_Zp) - Idep * sin(angle_autour_Zp)
	]
	else ,
	[
		X_tourne = xdep
		Y_tourne = ydep
		i_tourne = Idep
		j_tourne = Jdep
	]
pcalcul_axe_reels
	if tete_renvois,
	[
		#"voir" , *ra_offset$ ,*ra_svecx$,*ra_svecy$, e$
		Vec_X_Renvois = m7$
		Vec_Y_Renvois = m8$
		Vec_Z_Renvois = m9$
		ax = m7$ * m7$
		ay = m8$ * m8$
		if m9$ <> 0,
		[
			m9 = m9$
			point_vect = -(ax + ay) / m9$
			lg_vect_Z=sqrt(m7$^2 + m8$^2 + point_vect^2) 
			#"voir point_plan" , *m7$ , *m8$ , *point_vect ,e$
		
			m7_inter = (m7$ / lg_vect_Z) * -1
			m8_inter = (m8$ / lg_vect_Z) * -1
			m9_inter = (point_vect / lg_vect_Z) * -1
			if m9$ < 0,	
			[
				m7_inter = m7_inter * -1
				m8_inter = m8_inter * -1
				m9_inter = m9_inter * -1
			]
			angle_x = acos(m9_inter) 
			angle_z1 = atan2(m7_inter,m8_inter)
			angle_z0 = 0
		]
		else ,
		[		
			angle_x = 0
			angle_z1 = atan2(m7$,m8$)#(parceque axe B)
			angle_z0 = 0	
		]
		m1$ = ((cos(angle_z0) * cos(angle_z1)) - (cos(angle_x) * sin(angle_z0) * sin(angle_z1)))
		m2$ = ((-cos(angle_x) * cos(angle_z1) * sin(angle_z0)) - (cos(angle_z0) * sin(angle_z1)))
		m3$ = sin(angle_x) * sin(angle_z0)
		m4$ = ((cos(angle_z1) * sin(angle_z0)) + (cos(angle_x) * cos(angle_z0) * sin(angle_z1)))
		m5$ = ((cos(angle_x) * cos(angle_z0) * cos(angle_z1)) - (sin(angle_z0) * sin(angle_z1)))
		m6$ = -sin(angle_x) * cos(angle_z0) 
		m7$ = sin(angle_x) * sin(angle_z1)
		m8$ = sin(angle_x) * cos(angle_z1)
		m9$ = cos(angle_x)
		change_polar = 1
		axe_C_cal = axe_C_cal + 180
	]
    if usinage_5x = 0,  
	[
		tx=m7$
		ty=m8$
		tz=m9$
		old_axec_reel = axec_reel
		old_axeab_reel = axeab_reel
	]
    else,   
	[
		pcalcul_vecteur_5x
		tx=vx
		ty=vy
		tz=vz
		V_newX = vx	
		V_newY = vy
		V_newZ = vz	
		if debut_5X = 1, p_filtre
	]
	if Vect_porteur_x = 1,
	[
		axe_C_cal = atan2(tx,-ty) * sens_de_C
		axeab_reel = acos(tz) * sens_de_B
	]
	if Vect_porteur_y = 1,
	[
		axe_C_cal = atan2(ty,tx) * sens_de_C
		axeab_reel = acos(tz) * sens_de_B
	]
    if mi1$ = 1 & debut_5X = 0,   
	[
		change_polar = 1
	]
    if change_polar = 1,    
	[
		axe_C_cal = axe_C_cal + 180
		axeab_reel = axeab_reel * -1
	]
	if usinage_5x = 1,
	[
		if axeab_reel = 0,
		[
			if debut_5X = 0 , axe_C_cal = 0
			if debut_5X = 1 , axe_C_cal = old_axec_cal
		]
	]
    !old_axec_cal
	delta_axeC = old_axec_cal - axe_C_cal
	if abs (delta_axeC) > 180,
	[
		if delta_axeC > 0, nb_tour = nb_tour +1
		if delta_axeC < 0, nb_tour = nb_tour -1
	]
	axec_reel = axe_C_cal + (360*nb_tour)
	if verif_bute = no$, pbutee
	if verif_bute & (axec_reel > maxic | axec_reel < minic),
	[
		psortie_axeC
	]
	if angle_autour_X=0 & angle_autour_Y=0 & angle_autour_Z=0 & usinage_5x = 0,    
	[                                                                            
		axec_reel = 0
		axeab_reel = 0
	]
	if m7$ = 0 & m8$ = 0 & m9$ = 1 & tete_renvois,
	[
		axec_reel = angle_autour_Z +90
		axeab_reel = 0
		if tete_renvois & Vec_Z_Renvois = 0, axec_reel = axec_reel * -1
	]
	if axeab_reel = 0, axec_reel = mi4$
	verif_bute = no$
	old_axec_cal = axe_C_cal
p_filtre
    !tx
    !ty
    !tz
    !old_tx
    !old_ty
    !old_ty
	pscla = (Vold_newX * V_newX) + (Vold_newY * V_newY)
	if Vect_porteur_x = 1, axe_C_cal = atan2(tx,-ty)
	if Vect_porteur_y = 1,axe_C_cal = atan2(ty,tx)
	delta_axeC = old_axec_cal - axe_C_cal
	#"voir " , *pscla ,"delta " *delta_axeC,"solution ", *autre_solution ,e$
	if (pscla < 0 & abs (delta_axeC) >= 180) | autre_solution = 1,    
	[
		change_polar = change_polar * -1
	]
pcalcul_degage_vecteur
    xdegage_butee = old_x + (vecteur_degage * old_tx)
    ydegage_butee = old_y + (vecteur_degage * old_ty)
    zdegage_butee = old_z + (vecteur_degage * old_tz)
pcalcul_degage_axe
    axec_degage_butee = old_axec_reel + 180
    axeab_degage_butee = old_axeab_reel * -1
    if axec_degage_butee > 360, axec_degage_butee = axec_degage_butee - 360
    if axec_degage_butee < -360, axec_degage_butee = axec_degage_butee + 360
    old_axec_reel = axec_degage_butee
    pcalcul_axe_reels
fmt "" 2 dist_precage
pcalcul_percage_5X
    #"voir fond percage abs", *drl_depth_x$ ,*drl_depth_y$ ,*drl_depth_z$,e$
    dist_precage = abs (depth$ - drl_sel_tos$)
    vec_perc_X = u$ - drl_depth_x$
    vec_perc_Y = v$ - drl_depth_y$
    vec_perc_Z = w$ - drl_depth_z$
    Lg_vec_per = sqrt(vec_perc_X^2 + vec_perc_Y^2 + vec_perc_Z^2)
    vec_perc_X = vec_perc_X / Lg_vec_per
    vec_perc_Y = vec_perc_Y / Lg_vec_per
    vec_perc_Z = vec_perc_Z / Lg_vec_per
    surf_piece_X = drl_depth_x$ + (dist_precage  * vec_perc_X)
    surf_piece_Y = drl_depth_y$ + (dist_precage  * vec_perc_Y)
    surf_piece_Z = drl_depth_z$ + (dist_precage  * vec_perc_Z)
    #"voir surf_piece abs" , *surf_piece_X, *surf_piece_Y, *surf_piece_Z ,e$
    plan_secu_X = drl_init_x$
    plan_secu_Y = drl_init_y$
    plan_secu_Z = drl_init_z$
    #"voir plan secu abs" ,*drl_init_x$ , *drl_init_y$ , *drl_init_z$ ,e$
    plan_retract_X = surf_piece_X + ((retract_plane + garde_plane) * vec_perc_X)
    plan_retract_Y = surf_piece_Y + ((retract_plane + garde_plane) * vec_perc_Y)
    plan_retract_Z = surf_piece_Z + ((retract_plane + garde_plane) * vec_perc_Z)
    #"voir retract abs" , *plan_retract_X, *plan_retract_Y, *plan_retract_Z ,e$
    plan_garde_X = surf_piece_X + (garde_plane * vec_perc_X)
    plan_garde_Y = surf_piece_Y + (garde_plane * vec_perc_Y)
    plan_garde_Z = surf_piece_Z + (garde_plane * vec_perc_Z)
    #"voir garde abs" , *plan_garde_X, *plan_garde_Y, *plan_garde_Z ,e$
    # "recalcul dans le plan" ,e$
    xdep = surf_piece_X
    ydep = surf_piece_Y
    zdep = surf_piece_Z
    pcalcul_xyz_plan
    surf_piece_X = xplan
    surf_piece_Y = yplan
    surf_piece_Z = zplan
    #"voir surf_piece plan" , *surf_piece_X, *surf_piece_Y, *surf_piece_Z ,e$
    xdep = plan_secu_X
    ydep = plan_secu_Y
    zdep = plan_secu_Z
    pcalcul_xyz_plan
    plan_secu_X = xplan
    plan_secu_Y = yplan
    plan_secu_Z = zplan
    #"voir plan secu plan", *plan_secu_X, *plan_secu_Y, *plan_secu_Z ,e$
    xdep = plan_retract_X
    ydep = plan_retract_Y
    zdep = plan_retract_Z
    pcalcul_xyz_plan
    plan_retract_X = xplan
    plan_retract_Y = yplan
    plan_retract_Z = zplan
    #"voir retract plan" , *plan_retract_X, *plan_retract_Y, *plan_retract_Z ,e$
    xdep = plan_garde_X
    ydep = plan_garde_Y
    zdep = plan_garde_Z
    pcalcul_xyz_plan
    plan_garde_X = xplan
    plan_garde_Y = yplan
    plan_garde_Z = zplan
    #"voir garde abs" , *plan_garde_X, *plan_garde_Y, *plan_garde_Z ,e$
    xdep = drl_depth_x$
    ydep = drl_depth_y$
    zdep = drl_depth_z$
    pcalcul_xyz_plan
    drl_depth_xplan = xplan
    drl_depth_yplan = yplan
    drl_depth_zplan = zplan
    #"voir fond percage plan" , *drl_depth_xplan, *drl_depth_yplan, *drl_depth_zplan ,e$
    plan_secu_end_Z = plan_secu_Z
   # if use_secu_plane = 0 ,
    #[
   # 	plan_secu_end_Z = plan_retract_Z
   # 	plan_secu_Z = plan_retract_Z
   # ]
   # if use_secu_start_end = 1,
   # [
   # 	plan_secu_Z = plan_retract_Z
  #  ]
pcalcul_percage
    pcalcul_percage_5X
    bq200 = abs(refht$ - tosz$)
    if percage_5x = 1, bq200 = refht$ - drl_sel_tos$
    bq201 = abs(depth$ - tosz$)
    if percage_5x = 1, bq201 = abs (depth$ - drl_sel_tos$)
    if drillcyc$ = 0, bq202 = abs(bq201)
    else, bq202 = abs(peck1$)
    bq203 = tosz$
    if percage_5x = 1, bq203 = surf_piece_Z
    bq204 = initht$ #- bq203
    if percage_5x = 1, bq204 = plan_secu_Z
    if drillcyc$ = 1 , bq205 = abs(shftdrl$)
    bq206 = frplunge$
    if drillcyc$ = 4, bq208 = frplunge$
    else, bq208 = 9999
    bq210 = 0
    bq211 = dwell$
    if drillcyc$ = 1, bq212 = abs(retr$)
    if drillcyc$ = 2, bq213 = abs(bq201/bq202)
    else, bq213 = 0
    bq214 = abs(shftdrl$)
    if tool_typ$ = 5, bq239 = n_tap_thds$ * -1
    if tool_typ$ = 4, bq239 = n_tap_thds$
    if drillcyc$ = 6 , bq256 = abs(retr$)
    else, bq256 = 0.2
    if drillcyc$ = 6, bq257 = bq202
    if drillcyc$ = 2, bq257 = abs(peck2$)
    if drillcyc$ = 2, bq258 = 0.2
    if drillcyc$ = 2, bq259 = 0.2
    if drillcyc$ = 5, bq336 = abs(peckclr$)
    else, bq336 = 0
pcalcul_op
    if tool_op$ = 28 | tool_op$ = 29 | tool_op$ = 45 | tool_op$ = 46 | tool_op$ = 48 |
    tool_op$ = 49 | tool_op$ = 110 | tool_op$ = 111 | tool_op$ = 112 | tool_op$ = 113|
    tool_op$ = 154 | tool_op$ = 441 | tool_op$ = 442 | tool_op$ = 443 | tool_op$ = 444 |
    tool_op$ = 445 | tool_op$ = 446 | tool_op$ = 447 | tool_op$ = 448 | tool_op$ = 449 |
    tool_op$ = 450 | tool_op$ = 451 | tool_op$ = 459 | tool_op$ = 135 | (tool_op$ = 18 & nextop$ = 11),    
	[
		usinage_5x = 1
		if opcode$ = 16, percage_5x = 1
	]
    else, usinage_5x = 0, percage_5x = 0
pcalcul_matrice_5x
    longvec = sqrt(vx*vx+vy*vy+vz*vz)
    if longvec = 0, longvec = 1
    vx = vx/longvec
    vy = vy/longvec
    vz = vz/longvec
    angle_X = acos(vz)
    angle_Z0 = 180
    angle_Z1 = atan2(vx,vy)
    if (vx=0 & vy=0) , angle_Z1 = 0
    m1 = m1$
    m2 = m2$
    m3 = m3$
    m4 = m4$
    m5 = m5$
    m6 = m6$
    m7 = m7$
    m8 = m8$
    m9 = m9$
    m1$ = (cos(angle_Z0) * cos(angle_Z1)) - (cos(angle_X) * sin(angle_Z0) * sin(angle_Z1))
    m2$ = -(cos(angle_X) * cos(angle_Z1) * sin(angle_Z0)) - (cos(angle_Z0) * sin(angle_Z1))
    m3$ = (sin(angle_X) * sin(angle_Z0))
    m4$ = (cos(angle_Z1) * sin(angle_Z0)) + (cos(angle_X) * cos(angle_Z0) * sin(angle_Z1))
    m5$ = (cos(angle_X) * cos(angle_Z0) * cos(angle_Z1)) - (sin(angle_Z0) * sin(angle_Z1))
    m6$ = -sin(angle_X) * cos(angle_Z0)
    m7$ = sin(angle_X) * sin(angle_Z1)
    m8$ = sin(angle_X) * cos(angle_Z1)
    m9$ = cos(angle_X)
pcalcul_vecteur_5x
    vx = u$ - x$
    vy = v$ - y$
    vz = w$ - z$
    longvec = sqrt(vx*vx+vy*vy+vz*vz)
    if longvec = 0, longvec = 1
    vx = vx/longvec
    vy = vy/longvec
    vz = vz/longvec
pcalcul_xyz_plan
    # tourne le point autour de Z
    xplan_inter = ydep  * sin(angle_autour_Z) + xdep  * cos(angle_autour_Z)
    yplan_inter = ydep  * cos(angle_autour_Z) - xdep  * sin(angle_autour_Z)
    #  tourne le point autour Y
    zplan_inter = xplan_inter * sin(angle_autour_Y) + zdep * cos(angle_autour_Y)
    xplan = xplan_inter * cos(angle_autour_Y) - zdep  * sin(angle_autour_Y)
    # tourne le point autour de X
    yplan = zplan_inter * sin(angle_autour_X) + yplan_inter * cos(angle_autour_X)
    zplan = zplan_inter * cos(angle_autour_X) - yplan_inter * sin(angle_autour_X)
pcalcul_xyz_absolu
    !angle_autour_X, !angle_autour_Y, !angle_autour_Z
    angle_autour_X_2 = angle_autour_X * -1
    angle_autour_Z_2 = angle_autour_Z * -1
    angle_autour_Y_2 = angle_autour_Y * -1
    #   tourne le point autour X
    y1 = zdep * sin(angle_autour_X_2) + ydep * cos(angle_autour_X_2)
    z1 = zdep * cos(angle_autour_X_2) - ydep * sin(angle_autour_X_2)
    #   tourne le point autour Y
    zabs = xdep * sin(angle_autour_Y_2) + z1  * cos(angle_autour_Y_2)
    x1 = xdep * cos(angle_autour_Y_2) - z1  * sin(angle_autour_Y_2)
    # tourne le point autour de Z
    xabs = y1  * sin(angle_autour_Z_2) + x1  * cos(angle_autour_Z_2)
    yabs = y1  * cos(angle_autour_Z_2) - x1  * sin(angle_autour_Z_2)
pavance
    if (fr_pos$ = av_travail | fr_pos$ = av_plonge) & mr7$ = 1,    
	[
		if (av_travail = fr_pos$) & (av_plonge = fr_pos$), avance_param = 1, savance
		else,    
		[
			if av_travail = fr_pos$, avance_param = 1, savance
			if av_plonge = fr_pos$, avance_param = 0, savance
		]
	]
    else, fr_pos$
pavance_force
    if (fr_pos$ = av_travail | fr_pos$ = av_plonge) & mr7$ = 1,    
	[
		if (av_travail = fr_pos$) & (av_plonge = fr_pos$), avance_param = 1, *savance
		else,    
		[
			if av_travail = fr_pos$, avance_param = 1, *savance
			if av_plonge = fr_pos$, avance_param = 0, *savance
		]
	]
    else, *fr_pos$
#endregion

#region CORPS DU PP
pdec_ori
    !tox4$
    !old_tox4
    !toy4$
    !old_toy4
    !toz4$
    !old_toz4
    #if tox4$ <> old_tox4 | toy4$ <> old_toy4 | toz4$ <> old_toz4, n$, "ATRANS", *tox4$, *toy4$, *toz4$, e$
    old_tox4 = tox4$
    old_toy4 = toy4$
    old_toz4 = toz4$
pdegage
    gcode$ = 0
	if mode_deg > 0,    
	[
	
		n$, sgcode, smode_deg, *degagez,e$
		if tete_renvois, n$, sgcode, smode_deg, "Y-330.",e$
	]
    if mode_deg = 2, n$, sgcode, smode_deg,*degagey,  e$
    if mode_deg = 3, n$, sgcode, smode_deg,*degagex, *degagey,  e$
    #n$, "D1", e$
pannulplan
    axeab_reel = 0
	if tool_typ$ = 14,	[
						spdir$ = 0
    					@spdir$
    					n$, *spdlon, e$
						]	
	gcode$ = 1
	fr_pos$ = avanceG0					
	n$, sgcode, *axeab_reel, pavance, e$
	gcode$ = 0
	" ", e$	
	rtcp = 0
	orig = 0
    n$, sannul_plan,e$	
	pappel_origine
    n$, *srtcp, e$
    pdegage
    #n$, sannul_plan,e$
    #n$, sannul_Dec, e$
    old_tox4 = 0
    old_toy4 = 0
    old_toz4 = 0
pcycle32_on
    if mr8$ = 1,  #ebauche
    [
		n$ ,"CYCLE832(0.1,_ORI_ROUGH,0.25)", e$
    	cycl32 = 1
    ]
    if mr8$ = 2,  # 1/2 finition
    [
    	n$ ,"CYCLE832(0.05,_ORI_SEMIFIN,0.15)", e$
    	cycl32 = 1
    ]
    if mr8$ = 3,  #finition
    [
    	n$ ,"CYCLE832(0.03,_ORI_FINISH,0.1)", e$
    	cycl32 = 1
    ]
pcycle32_off
    if cycl32 = 1,  
	[
		n$, "CYCLE832 ()",e$
		cycl32 = 0
	]
pdecfin
    n$, "ATRANS X0 Y0 Z0", e$
pplan
    mi1_2 = mi1$
    pcalcul_plan
    pcalcul_axe_reels
    !mi1_2
    if percage_5x <> 1, 
	[
		xdep = xr$ + tox$
		ydep = yr$ + toy$
		zdep = zr$ + toz$
		pcalcul_xyz_absolu
	]

#   if degage_butee = 0, 
#	[
#		freinC = 0
#		freinB = 0
#		n$, sfreinB, e$
#		n$, sfreinC, e$
#		n$, sg00, *axeab_reel, *axec_reel,e$
#		freinC = 1
#		freinB = 1
#		n$, sfreinB, e$
#		n$, sfreinC, e$
#	]
	rtcp = 1
	n$ , srtcp ,e$
	if tete_renvois & simu = 0,
	[
		n$, *Vec_X_Renvois ,e$
		n$, *Vec_Y_Renvois ,e$
		n$, *Vec_Z_Renvois ,e$
		X_absrenvois = xabs
		Y_absrenvois = yabs
		Z_absrenvois = zabs
		n$, *X_absrenvois, "+($TC_DP6[$P_TOOLNO,$P_TOOL]* R4)",e$
		n$, *Y_absrenvois, "+($TC_DP6[$P_TOOLNO,$P_TOOL]*R5)" ,e$
		n$, *Z_absrenvois, "+($TC_DP6[$P_TOOLNO,$P_TOOL]*R6)" ,e$
		n$, "G0 X=R1 Y=R2" ,e$
		n$, "G0 Z=R3" ,e$	
	]
	else,
	[
		orig = 1
		pappel_origine
		freinC = 0
		freinB = 0
		n$, sfreinB, e$
		n$, sfreinC, e$
		gcode$ = 0
		n$, *sgcode,*xabs, *yabs, *axec_reel, e$
		n$, sgcode, *zabs, e$
	]
	if degage_butee = 0, 
	[
		freinC = 0
		freinB = 0
		n$, sfreinB, e$
		n$, sfreinC, e$
		#n$, sg00, *axeab_reel, *axec_reel,e$
		fr_pos$ = 0
		!fr_pos$
		@fr_pos$
		fr_pos$ = avanceG0
		gcode$ = 1
		n$, *sgcode, *axeab_reel, *axec_reel, pavance, e$
		freinC = 1
		freinB = 1
		n$, sfreinB, e$
		n$, sfreinC, e$
	]
	if simu = 1,
	[
	#	rtcp = 0
	#	n$ , srtcp ,e$
	]
    #if mr8$<> 0, pcycle32_on
    #else, pcycle32_off
    #if usinage_5x = 0, pdec_ori
    pecriture_plan
	if tete_renvois & simu = 0, n$ ,"ATRANS Z=$TC_DP6[$P_TOOLNO,$P_TOOL]",e$
    if mr9$ = 1, pdecfin
pappel_origine
	#n$, "(UIO,X(-$PRPUX(1,1)),Z($PRPUZ(1,1)))", e$
	n$, sorig, e$

pecriture_plan
	#rtcp = 0
    #n$, srtcp, e$
	pdec_ori
	spaces$ = 0
	C_plan = axec_reel
	B_plan = axeab_reel * -1
	if C_plan > 180, C_plan = C_plan - 360
	if C_plan < -180, C_plan = C_plan + 360
	#n$," (UPR,0,XYZ,", *angle_autour_X,",",*angle_autour_Y,",",*angle_autour_Z,",",*tox4$,",",*toy4$,",",*toz4$, ")", e$
	n$,"(UPR,0,XYZ,0.,0.,", *C_plan, ",", *tox4$,",",*toy4$,",",*toz4$, ")", e$
    n$,"(UPR,1,XYZ," , *B_plan,",0.,0.)" ,e$
	spaces$ = 1
spaspay_ : "Contact F.i.cam for this problem at +33 2 37 26 28 10."

pheader$
	usecandrill$ = no$
	usecanpeck$  = no$
	usecanchip$ = no$
	usecantap$  = no$
	usecanbore1$ = no$
	usecanbore2$  = no$
	usecanmisc1$ = no$
	usecanmisc2$ = no$
    rd_md$
	rd_tlpathgrp$
	psimulation
	pstart_header
	pcalcul_block_form
	spaces$ =0
	#"WORKPIECE(,",34 34,",,",34 *stck_type 34,",64,", *zmin,",", *stck_thck$, ",0,", *xmin, ",", *ymin, ",", *stck_ht$, ",", *stck_wdth$ ,")",e$
	spaces$ =1
    pend_header
psof$
    avanceG0 = mi10$
	!avanceG0
	@avanceG0
	pstart_posf
    old_op_id = op_id$
    pend_psof
    ptlchg$
ptlchg$
	avanceG0 = mi10$
	!avanceG0
	@avanceG0	
	retournement_OK = no$
	first_hole = yes$
	sort_pdrill = no$
	if simu = 1 ,precal_new_matrice_RUD
    i$ = 99999.99
    j$ = 99999.99
	nb_tour = mi2$
    percage_5x = 0
    change_polar = -1
    old_axec_reel = 0
    old_axeab_reel = 0
	old_axec_cal = 0
    pstart_ptlchg
    plub_off
    old_spdir = spdir$
    spdir$ = 0
    @spdir$
    n$, *spdlon, e$
    spdir$ = old_spdir
    @spdir$
    pcalcul_op
    pannulplan
	axec_reel = 0
	axeab_reel = 0
	freinC = 0
	freinB = 0
	n$, sfreinB, e$
	n$, sfreinC, e$
	gcode$ = 1
	fr_pos$ = avanceG0					
	n$, sgcode, *axeab_reel, *axec_reel, pavance, e$
	gcode$ = 0
	comment$
    pnumop
	" " ,e$
	#if simu <> 1, spaces$ = 0, n$ ," ",  34, *saut_out , 34,e$, spaces$ = 1
	saut_out = saut_out +1
    n$, sarret_optionnel, e$
	if t$  = 10, tete_renvois = yes$
	else , tete_renvois = no$
    pstart_outil_ptlchg
	#n$, "M998" ,e$
	pjump	
	n$, "G0 G79 Z0", e$
	n$, "G0 G79 Y0", e$
	spaces$ = 0
	if use_name_tool, n$,"T=", 34, paff_tooll_change, 34, " M6", e$
	else , spaces$ = 1, n$, *t$, "M6" ,e$
	spaces$ = 1
	#n$, "D1" ,e$
    n$, "(DIS,", 34, *numop, 34, ")", e$
	spaces$ = 0
    #if bldnxtool$ = 1, 
	#[
	#	if use_name_tool, n$, "T=", 34, paffichenext_tool, 34, e$
	#	else , n$, *next_tool$ , e$
	#]
	spaces$ = 1
    pend_outil_ptlchg
    if tool_typ$ <> 14, n$, *spdlon, *ss$, e$
    #n$, tloffno$, e$
	tlngno$ = t$
	n$, tlngno$, e$
    if usinage_5x <> 1, 
	[
		pplan
		xdep = xr$
		ydep = yr$
		pcalcul_tourne
		fr_pos$ = avanceG0
		gcode$ = 1
		n$, *sgcode, *X_tourne *Y_tourne, pavance, e$
	]
    old_m7 = m7$
    old_m8 = m8$
    old_m9 = m9$
	old_xform_opid = xform_op_id$
    old_op_id = op_id$
	old_tool_op = tool_op$
    pend_ptlchg
    old_op5X = 0
    pend_ptlchg
ptlchg0$
	avanceG0 = mi10$
	!avanceG0
	@avanceG0	
	if simu = 1 ,precal_new_matrice_RUD
    pstart_between_path_ptlchg0
    !old_op_id
	if mi3$ = 1, 
	[
		nb_tour = mi2$
		old_axec_cal = 0
		old_axeab_reel = 0	
	]
    if op_id$ <> old_op_id | old_m7 <> m7$ | old_m8 <> m8$ | old_m9 <> m9$,    
	[
		first_hole = yes$
		sort_pdrill = no$
		retournement_OK = no$
		i$ = 99999.99
		j$ = 99999.99
		pstart_between_op_ptlchg0
		percage_5x = 0
		pcalcul_op
		if old_op5X & old_tool_op = 154 & usinage_5x = 1, 
		[
			pcalcul_op
			pjump
			pnumop
			if op_id$ <> old_op_id, "(DIS,", 34,, *numop, 34, ")", e$
			ex$
		]
		if usinage_5x = 1,
		[
			if old_tool_op <> 154 & tool_op$ <> 154, 
			[
				pannulplan
			]
			else,
			[
				if tool_op$ = 154,
				[
					n$, sannul_plan,e$
    				#n$, sannul_Dec, e$
				]
			]
		]
		pnumop
		if old_tool_op <> 154 & tool_op$ <> 154,change_polar = -1
		pcalcul_plan
		!old_angle_autour_X
		!angle_autour_X
		!old_angle_autour_Y
		!angle_autour_Y
		!old_angle_autour_Z
		!angle_autour_Z
		if old_op_id <> op_id$ | old_angle_autour_X <> angle_autour_X | old_angle_autour_Y <> angle_autour_Y | old_angle_autour_Z <> angle_autour_Z | old_op5X = 1,
		[
			if old_tool_op <> 154 & tool_op$ <> 154, pannulplan
			n$, sarret_optionnel, e$
			nb_tour = mi2$
			old_axec_cal = 0
    		old_axeab_reel = 0
			if op_id$ <> old_op_id | old_xform_opid <> xform_op_id$, n$, 
			[
				pjump
				comment$
				"(DIS,", 34,, *numop, 34, ")", e$			
			]
			if usinage_5x <> 1,
			[
				pplan
				xdep = xr$
				ydep = yr$
				pcalcul_tourne
				fr_pos$ = avanceG0
				gcode$ = 1
				n$, *sgcode, *X_tourne *Y_tourne, pavance, e$
			]
		]
		else,
		[
			pjump
			comment$
			n$, "(DIS,", 34,, *numop, 34, ")", e$
		]
	]
    old_m7 = m7$
    old_m8 = m8$
    old_m9 = m9$
	old_xform_opid = xform_op_id$
	old_tool_op = tool_op$
    old_op5X = 0
    old_op_id = op_id$
    pend_ptlchg0
plin$

	if opcode$ = 16 , pmx$
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne
		n$, sgcode, pcorrection, X_tourne, Y_tourne, z$, pavance, e$
	]
    old_x = x$
    old_y = y$
    old_z = z$
pcir$
	if opcode$ = 16 , pmx$
	else,
	[
		xdep = x$
		ydep = y$
		Idep = i$
		Jdep = j$
		pcalcul_tourne
    	n$, sgcode, *X_tourne, *Y_tourne, *z$, *arcrad$, e$#*i_tourne, *j_tourne, pavance, e$
	]
	old_x = x$
    old_y = y$
    old_z = z$
pz$
	if opcode$ = 16 , pmx$
	else,
	[
    	n$, sgcode, z$, pavance, e$
	]
    old_z = z$
prapid$
	if opcode$ = 16 , pmx$
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne
		fr_pos$ = avanceG0
		gcode$ = 1
    	n$, `sgcode, X_tourne, Y_tourne, z$, pavance, e$
	]
    old_x = x$
    old_y = y$
    old_z = z$
pzrapid$
	if opcode$ = 16 , pmx$
	else,
	[
    fr_pos$ = avanceG0
	gcode$ = 1	
	n$, sgcode, z$, plub_on, pavance, e$
	]
    old_z = z$
pmx0$
pdebut_percage
	pcalcul_vecteur_5x
	pcalcul_matrice_5x
	xabs = xr$
	yabs = yr$
	zabs = zr$
	pplan
	xdep = drl_init_x$
	ydep = drl_init_y$
	zdep = drl_init_z$
	pcalcul_xyz_plan
	fr_pos$ = avanceG0
	gcode$ = 1
	n$, *sgcode, *xplan, *yplan, pavance, e$
	n$, sgcode, *zplan, plub_on, pavance, e$
	old_zplan = zplan
pmx$
   # if percage_5x = 0 | safety_zone,    
	#[
		pcalcul_plan
		xdep = x$ + tox$
		ydep = y$ + toy$
		zdep = z$ + toz$
		pcalcul_xyz_absolu
		x$ = xabs
		y$ = yabs
		z$ = zabs
		xdep = u$ + tox$
		ydep = v$ + toy$
		zdep = w$ + toz$
		pcalcul_xyz_absolu
		u$ = xabs
		v$ = yabs
		w$ = zabs
		pcalcul_axe_reels
	#]
    if debut_5X = 0 ,    #& percage_5x = 0
	[
		freinC = 0
		freinB = 0
		n$, sfreinB, e$
		n$, sfreinC, e$
		if tool_op$ = 154,
		[
			rtcp = 1
			n$, srtcp, e$
			orig = 1
			pappel_origine	
			gcode$ = 0
			n$, sgcode, *x$, *y$, *z$,*axeab_reel, *axec_reel, e$
		]
		else,
		[
			#n$, sg00, *axeab_reel, *axec_reel, e$
			rtcp = 1
			n$, srtcp, e$
			orig = 1
			pappel_origine
			gcode$ = 0
			n$, *sgcode, *x$, *y$, *axec_reel, e$
			n$, sgcode, *z$, e$
			fr_pos$ = 0
			!fr_pos$
			@fr_pos$
			fr_pos$ = avanceG0
			gcode$ = 1
			n$, sgcode, *axeab_reel, *axec_reel, pavance, e$	
			if tool_typ$ = 14,	[
								spdir$ = old_spdir
								n$, *spdlon, *ss$, e$
								]		
		]
	]
    debut_5X = 1
	if axeab_reel <> 0,
	[
    	old_tx = tx
    	old_ty = ty
    	old_tz = tz
		Vold_newX = tx	
		Vold_newY = ty
		Vold_newZ = tz
	]
    old_x = x$
    old_y = y$
    old_z = z$
    old_axec_reel = axec_reel
    old_axeab_reel = axeab_reel
    #if percage_5x = 1,
	#[
	#	if safety_zone = no$ | first_hole,  ex$
	#	if safety_zone & sort_pdrill,
	#	[
    #		n$, sannul_plan,e$
    #		#n$, sannul_Dec, e$		
	#	]
	#]
	#if percage_5x = 1 & safety_zone & cutpos$ =5 ,ex$
    rtcp = 1
    n$, srtcp, e$
	orig = 1
	pappel_origine		
    if fr$ = -2, gcode$ = 0
	else, gcode$ = 1
	if gcode$ = 0,	[
					gcode$ = 1
					fr_pos$ = avanceG0
					n$, sgcode, x$, y$, z$, axeab_reel, axec_reel, pavance, e$
					]
    else, n$, sgcode, x$, y$, z$, axeab_reel, axec_reel, pcorrection, pavance, plub_on ,e$
    old_op5X = 1
    old_op_id = op_id$
	sort_pdrill = no$
pbutee
	verif_bute = yes$
    if axeab_reel > maxiab | axeab_reel < miniab,   
	[
		psortie_axeab
	]
	if axec_reel > maxic | axec_reel < minic,
	[
		if usinage_5x = 0 | debut_5X = 0,
		[
			change_polar = 1
			pcalcul_axe_reels
		]
		if usinage_5x = 1 & debut_5X = 1, 
		[
			if axec_reel > maxic, nb_tour = nb_tour -1
			if axec_reel < minic, nb_tour = nb_tour +1			
			if opcode$ <> 16, pdegage_butee
			else, pcalcul_axe_reels
		]
	] 
pdegage_butee
	old_fr_pos = fr_pos$
	if retournement_OK = no$, pretournement
	if mr1$ = 0, q1
    vecteur_degage = feed_plane
    pcalcul_degage_vecteur
    !xdegage_butee
    !ydegage_butee
    !zdegage_butee
	gcode$ = 1
    n$, sgcode, *xdegage_butee, *ydegage_butee, *zdegage_butee, pcorrection, pavance, plub_on, e$
    if use_secu_plane = 1, vecteur_degage = secu_plane
    if use_retract_plane = 1, vecteur_degage = retract_plane
    if use_retract_plane = 1 & use_secu_start_end = 0, vecteur_degage = secu_plane
    if use_secu_plane = 0 & use_retract_plane = 0, vecteur_degage = feed_plane
	vecteur_degage = mr1$
    if vecteur_degage <> feed_plane,    
	[
		pcalcul_degage_vecteur
		!xdegage_butee
		!ydegage_butee
		!zdegage_butee
		fr_pos$ = avanceG0
		gcode$ = 1	
		n$, sgcode, *xdegage_butee, *ydegage_butee, *zdegage_butee, pavance, e$
	]
    pcalcul_axe_reels
    !axeab_degage_butee
    !axec_degage_butee
	rtcp = 0
	orig = 0
	pappel_origine		
	n$ , srtcp ,e$
	#n$, sg00, smode_deg, *degagez, e$
	#n$ , "D1" ,e$
	fr_pos$ = avanceG0
	gcode$ = 1
    n$, sgcode, *axec_reel, *axeab_reel, pavance, e$
	rtcp = 1
	n$ , srtcp ,e$
	orig = 1
	pappel_origine		
    if vecteur_degage <> feed_plane,    
	[
		fr_pos$ = avanceG0
		gcode$ = 1
		n$, sgcode, *xdegage_butee, *ydegage_butee, *zdegage_butee, pavance, e$
		vecteur_degage = feed_plane
		pcalcul_degage_vecteur
		!xdegage_butee
		!ydegage_butee
		!zdegage_butee
		fr_pos$ = avanceG0
		gcode$ = 1
		n$, sgcode, *xdegage_butee, *ydegage_butee, *zdegage_butee, pavance, e$
	]
    gcode$ = 1
	fr_pos$ = old_fr_pos
	n$, sgcode, *old_x, *old_y, *old_z, *axec_reel, *axeab_reel, pcorrection, pavance_force, plub_on, e$
pretournement
	serreur_visu = sretournement + no2str(numop)
	result = mprint(serreur_visu,2)
	if result = 1,
	[
		n$, "(DIS,", 34,*serreur_visu, 34, ")", e$
		retournement_OK = yes$
	]
psortie_axeab
    if erreur = 0,  
	[
		serreur_visu = serreuraxeab_1 + no2str(miniab) + " et " + no2str(maxiab) + serreuraxeab_2 + no2str(numop)
		result = mprint(serreur_visu,1)
		*serreur_visu, e$
		erreur = 1
		exitpost$
	]
psortie_axeC
    if erreur = 0,  
	[
		serreur_visu = serreuraxeC + no2str(minic) + " et " + no2str(maxic) + serreuraxeab_2 + no2str(numop)
		result = mprint(serreur_visu,1)
		*serreur_visu, e$
		erreur = 1
		exitpost$
	]
pperc_5X
    xdep = x$
    ydep = y$
    zdep = z$
    pcalcul_xyz_plan
    x$ = xplan
    y$ = yplan
    z$ = zplan
pperc_5X_2
	if axeab_reel <> 0,
	[
    	old_tx = tx
    	old_ty = ty
    	old_tz = tz
	]
	pcalcul_vecteur_5x
    pcalcul_axe_reels
    pcalcul_matrice_5x
    xabs = drl_init_x$
    yabs = drl_init_y$
    zabs = drl_init_z$
    n$, sannul_plan,e$
    #n$, sannul_Dec, e$
    old_tox4 = 0
    old_toy4 = 0
    old_toz4 = 0
    ptransi_perc_5X
    xdep = x$
    ydep = y$
    zdep = z$
    pcalcul_xyz_plan
    x$ = xplan
    y$ = yplan
    z$ = zplan
	sort_pdrill = yes$
ptransi_perc_5X
	spaces$ = 1
    rtcp = 1
    pcalcul_plan
    pcalcul_axe_reels
    n$, srtcp,e$
	orig = 1
	pappel_origine		
	gcode$ = 1
	fr_pos$ = avanceG0
    n$, sgcode, *xabs, *yabs, *zabs,*axeab_reel, *axec_reel, pavance, e$
    rtcp = 0
	orig = 0
	pappel_origine	
    n$ , srtcp ,e$
    pecriture_plan
pdrill$
    if percage_5x = 1, 
	[
		if first_hole | safety_zone = no$,
		[
			pdebut_percage		
			pperc_5X
		]
		else, pperc_5X_2
	]
	xdep = x$
	ydep = y$
	pcalcul_tourne	
    pcalcul_percage
    !z$
    #n$, *bq206, plub_on, e$
    #if percage_5x = 1, 	n$, sm99, "CYCLE82(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ")",e$
   	#else , n$, sm99, "CYCLE82(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ")",e$
	if dwell$ = 0, n$, "G81", *X_tourne, *Y_tourne, *depth$, *refht$, *bq206, e$
	else, n$, "G82", *X_tourne, *Y_tourne, *depth$, *refht$, *bq206, *bq211, e$	
	#n$, sg00, *X_tourne, *Y_tourne, e$
	#if percage_5x = 1, n$, sm99, e$
	
	first_hole = no$
	sort_pdrill = yes$
	!x$,!y$,!z$
pdrill_2$
    old_bq200 = bq200
    old_bq201 = bq201
    pcalcul_percage
    if percage_5x = 1,    
	[
		pperc_5X_2
		pcalcul_percage
		gcode$ = 0
		n$, sgcode, *x$, *y$, plan_secu_Z ,e$
		if dwell$ = 0, n$, "G81", *X_tourne, *Y_tourne, *depth$, *refht$, *bq206, e$
		else, n$, "G82", *X_tourne, *Y_tourne, *depth$, *refht$, *bq206, *bq211, e$			
		#n$, sm99, "CYCLE82(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ")",e$
		#n$, sg00, *x$, *y$,e$
		n$, "G80", *plan_secu_Z, e$
		#n$, sm99, e$
	]
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne	
    	!bq200 , !old_bq200 , !bq201 , !old_bq201
    	if bq200 <> old_bq200 | bq201 <> old_bq201,	[
													n$, "G80", *old_zplan, e$
													pdrill$
													]
    	else, gcode$ = 0, n$, sgcode, *X_tourne, *Y_tourne, e$
	]
	!x$,!y$,!z$
ppeck$
    if percage_5x = 1, 
	[
		if first_hole | safety_zone = no$,
		[
			pdebut_percage
			pperc_5X
		]
		else, pperc_5X_2
	] 
	xdep = x$
	ydep = y$
	pcalcul_tourne	 
    pcalcul_percage
    !z$
    n$, *bq206, plub_on, e$
    if percage_5x = 1, n$, sm99, "CYCLE83(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", ",", *bq202, ",", *bq202, ",0,0,100,1,0,,,0,)",e$
    else ,n$, sm99, "CYCLE83(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", ",", *bq202, ",", *bq202, ",0,0,100,1,0,,,0,)",e$
    gcode$ = 0
	n$, sgcode, *X_tourne, *Y_tourne, e$
   	if percage_5x = 1, n$, sm99, e$
	first_hole = no$
	sort_pdrill = yes$
	!x$,!y$,!z$
ppeck_2$
    old_bq200 = bq200
    old_bq201 = bq201
    pcalcul_percage
    if percage_5x = 1 , 
	[
		pperc_5X_2
		pcalcul_percage
		gcode$ = 0
		n$, sgcode, *x$, *y$, plan_secu_Z ,e$
		n$, sm99, "CYCLE83(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", ",", *bq202, ",", *bq202, ",0,0,100,1,0,,,0,)",e$
		n$, sgcode, *x$, *y$,e$
		n$, sm99, e$
	]
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne	
    	!bq200 , !old_bq200 , !bq201 , !old_bq201
    	if bq200 <> old_bq200 | bq201 <> old_bq201, ppeck$
    	else, gcode$ = 0, n$, sgcode, *X_tourne, *Y_tourne, e$
	]
	!x$,!y$,!z$
pchpbrk$
    if percage_5x = 1, 
	[
		if first_hole | safety_zone = no$,
		[
			pdebut_percage
			pperc_5X
		]
		else, pperc_5X_2
	] 
	xdep = x$
	ydep = y$
	pcalcul_tourne	   
    pcalcul_percage
    !z$
    n$, *bq206, plub_on, e$
    if percage_5x = 1, n$, sm99, "CYCLE83(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", ",", *bq202, ",", *bq202, ",0,0,100,0,0,,0.2,0,)",e$
    else ,n$, sm99, "CYCLE83(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", ",", *bq202, ",", *bq202, ",0,0,100,0,0,,0.2,0,)",e$
    gcode$ = 0
	n$, sgcode, *X_tourne, *Y_tourne, e$
   	if percage_5x = 1, n$, sm99, e$
	first_hole = no$
	sort_pdrill = yes$
	!x$,!y$,!z$
pchpbrk_2$
    old_bq200 = bq200
    old_bq201 = bq201
    pcalcul_percage
    if percage_5x = 1 , 
	[
		pperc_5X_2
		pcalcul_percage
		gcode$ = 0
		n$, sgcode, *x$, *y$, plan_secu_Z ,e$
		n$, sm99, "CYCLE83(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", ",", *bq202, ",", *bq202, ",0,0,100,0,0,,0.2,0,)",e$
		n$, sgcode, *x$, *y$,e$
		n$, sm99, e$
	]
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne
    	!bq200 , !old_bq200 , !bq201 , !old_bq201
    	if bq200 <> old_bq200 | bq201 <> old_bq201, pchpbrk$
    	else, gcode$ = 0, n$, sgcode, *X_tourne, *Y_tourne, e$
	]
	!x$,!y$,!z$
ptap$
    if percage_5x = 1, 
	[
		if first_hole | safety_zone = no$,
		[
			pdebut_percage
			pperc_5X
		]
		else, pperc_5X_2
	]
	xdep = x$
	ydep = y$
	pcalcul_tourne	  
    pcalcul_percage
    !z$
    n$, sm02, e$
    n$, plub_on, e$
    if spdir$ = -1 , dir_tar = 4
    if spdir$ = 0 , dir_tar = 5
    if spdir$ = 1 , dir_tar = 3
    speed_tar = ss$
    if percage_5x = 1,
	[
		if bq202 = 0, n$, sm99, "CYCLE84(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211,",", *dir_tar,",,", *bq239,",0,"*speed_tar,",",*speed_tar,",3,,0,,,)",e$
		else, sm99, "CYCLE84(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211,",", *dir_tar,",,", *bq239,",0,"*speed_tar,",",*speed_tar,",3,1,0,2,",*bq202, ",)",e$
	]
    else, 
	[
		if bq202 = 0, sm99, n$, "CYCLE84(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211,",", *dir_tar,",,", *bq239,",0,"*speed_tar,",",*speed_tar,",3,,0,,,)",e$
		else, sm99, "CYCLE84(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211,",", *dir_tar,",,", *bq239,",0,"*speed_tar,",",*speed_tar,",3,1,0,2,",*bq202, ",)",e$
	]
    gcode$ = 0
	n$, sgcode, *X_tourne, *Y_tourne, e$
	first_hole = no$
	sort_pdrill = yes$
	!x$,!y$,!z$
    #n$, sm99, e$
ptap_2$
    old_bq200 = bq200
    old_bq201 = bq201
    pcalcul_percage
    if percage_5x = 1 , 
	[
		pperc_5X_2
		pcalcul_percage
		gcode$ = 0
		n$, sgcode, *x$, *y$, plan_secu_Z ,e$
		if bq202 = 0,n$, sm99, "CYCLE84(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211,",", *dir_tar,",,", *bq239,",0,"*speed_tar,",",*speed_tar,",3,,0,,,)",e$
		else,sm99, "CYCLE84(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211,",", *dir_tar,",,", *bq239,",0,"*speed_tar,",",*speed_tar,",3,1,0,2,",*bq202, ",)",e$
		n$, sgcode, *x$, *y$,e$
		n$, sm99, e$
	]
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne
    	!bq200 , !old_bq200 , !bq201 , !old_bq201
    	if bq200 <> old_bq200 | bq201 <> old_bq201, ptap$
    	else, gcode$ = 0, n$, sgcode, *X_tourne, *Y_tourne, e$
	]
	!x$,!y$,!z$
pbore1$
    if percage_5x = 1, 
	[
		if first_hole | safety_zone = no$,
		[
			pdebut_percage
			pperc_5X
		]
		else, pperc_5X_2
	]
	xdep = x$
	ydep = y$
	pcalcul_tourne	 
    pcalcul_percage
    !z$
    n$, sm02, e$
    n$, *bq206, plub_on, e$
    avance_al = bq206
    if percage_5x = 1, n$, sm99, "CYCLE85(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ",", *avance_al , "," , *avance_al ,")",e$
    else ,sm99 , "CYCLE85(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ",", *avance_al , "," , *avance_al ,")",e$
    gcode$ = 0
	n$, sgcode, *X_tourne, *Y_tourne, e$
   	if percage_5x = 1, n$, sm99, e$
	first_hole = no$
	sort_pdrill = yes$
	!x$,!y$,!z$
pbore1_2$
    old_bq200 = bq200
    old_bq201 = bq201
    pcalcul_percage
    !z$
    if percage_5x = 1 , 
	[
		pperc_5X_2
		pcalcul_percage
		gcode$ = 0
		n$, sgcode, *x$, *y$, plan_secu_Z ,e$
		n$, sm99, "CYCLE85(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ",", *avance_al , "," , *avance_al ,")",e$
		n$, sgcode, *x$, *y$,e$
		n$, sm99, e$
	]
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne
    	!bq200 , !old_bq200 , !bq201 , !old_bq201
    	if bq200 <> old_bq200 | bq201 <> old_bq201, pbore1$
    	else, gcode$ = 0, n$, sgcode, *X_tourne, *Y_tourne, e$
	]
	!x$,!y$,!z$
pbore2$
    if percage_5x = 1, 
	[
		if first_hole | safety_zone = no$,
		[
			pdebut_percage
			pperc_5X
		]
		else, pperc_5X_2
	]
	xdep = x$
	ydep = y$
	pcalcul_tourne	 
    pcalcul_percage
    !z$
    n$, sm02, e$
    n$, *bq206, plub_on, e$
    if percage_5x = 1, n$, sm99, "CYCLE86(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ",3," ,*bq214 ,",0,,", *bq336, ")",e$
    else ,sm99,  "CYCLE86(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ",3," ,*bq214 ,",0,,", *bq336, ")",e$
    gcode$ = 0
	n$, sgcode, *X_tourne, *Y_tourne, e$
    if percage_5x = 1, n$, sm99, e$
	first_hole = no$
	sort_pdrill = yes$
	!x$,!y$,!z$
pbore2_2$
    old_bq200 = bq200
    old_bq201 = bq201
    pcalcul_percage
    if percage_5x = 1 , 
	[
		pperc_5X_2
		pcalcul_percage
		gcode$ = 0
		n$, sgcode, *x$, *y$, plan_secu_Z ,e$
		n$, sm99, "CYCLE86(",*bq204, ",", *bq203, ",", *bq200, ",,", *bq201, ",", *bq211, ",3," ,*bq214 ,",0,,", *bq336, ")",e$
		n$, sgcode, *x$, *y$,e$
		n$, sm99, e$
	]
	else,
	[
		xdep = x$
		ydep = y$
		pcalcul_tourne
    	!bq200 , !old_bq200 , !bq201 , !old_bq201
    	if bq200 <> old_bq200 | bq201 <> old_bq201, pbore2$
    	else, gcode$ = 0, n$, sgcode, *X_tourne, *Y_tourne, e$
	]
	!x$,!y$,!z$
pmisc1$

pmisc1_2$

pcanceldc$
    #if percage_5x <> 1 , n$, sm99, e$
    if percage_5x = 1,  
	[
		gcode$ = 0
		n$, sgcode, *plan_secu_end_Z, e$
	]
    else, n$, "G80", *initht$, e$
pmisc2$
pmisc2_2$
pdrlcst$
pdrlcst_2$
pdrill0$
pdrl_end$
pcancelcc$
peof$
    axeab_reel = 0
	if tool_typ$ = 14,	[
						spdir$ = 0
    					@spdir$
    					n$, *spdlon, e$
						]	
	gcode$ = 1
	fr_pos$ = avanceG0					
	n$, sgcode, *axeab_reel, pavance, e$
	gcode$ = 0	
	" ", e$
	rtcp = 0
	#orig = 0
	#pappel_origine		
    n$, *srtcp, e$
	#n$, "(UAO,0)", e$
    pstart_peof
	axeab_reel = 0
	axec_reel = 0
    n$, sgcode, smode_deg, *degagez,e$
	n$, "M33 ;Debloquer Axe C" ,e$
	n$, "M31 ;Debloquer Axe B" ,e$	
	n$, sgcode, *axeab_reel, *axec_reel, e$
	#n$, "M998" ,e$
	n$, sannul_plan, e$
    pend_peof
    n$, "#@KEY1=0", e$
	spaces$ = 0
	n$, 34,"N0",34, e$
	n$, "#SC0.4=", 34, "N0", 34, e$
	n$, "(GTO,END)", e$
	n$, "M00", e$
	n$, 34, "END", 34, e$
	n$, ";Fin de programme", e$
	if pendolo = 0, n$, "M30", e$
pdwl_spd$
pmiscint$
pmiscparam$
pmiscreal$
pq$
ptoolend$
ptooltable$
ptransint$
ptransreal$
puid_list$
psof0$
psof00$
psof_end$
ptlchg00$
ptlchg0_end$
ptlchg_end$
peof0$
peof00$
plin0$
plin_end$
pcir0$
pcir_end$
pmachineinfo$
	#~prmcode$, "=", sparameter$, e$
	if prmcode$ = 19133, type_stock = rpar(sparameter$, 1)
    if prmcode$ = 17012, snom_ini = sparameter$
    smachine = ucase (snom_ini)
psub_call_s$
psub_st_s$
psub_end_s$
psub_call_mm$
psub_call_m$
psub_end_m_r$
psub_st_m$
psub_end_m$
pcomment0$
pcomment_end$
pmx_end$
prot0$
prot$

#endregion
#[ENDBIN]
#region paramametrage specifique du pp
pprep$
    rotaxtyp$ = 3
    tooltable$ = 1 #0=non 1=oui liste des outils
sf00 : "FQ1"
sf01 : "FQ11"
savance : ""
fstrsel sf00 avance_param savance 2 -1

plub_on
    !coolant$
	lub = 1
    if lub = 0,    
	[
		if coolant$ = 0 ,"M9"
		if coolant$ = 1 ,"M8"
		if coolant$ = 2 ,"M7"
		if coolant$ = 3 ,"M7 M8"
	]
    lub = 1
plub_off
    !coolant$
    if coolant$ = 0 , n$, "M9", e$
    if coolant$ = 1 , n$, "M9", e$
    if coolant$ = 2 , n$, "M9", e$
    if coolant$ = 3 , n$, "M9", e$
    lub = 0
#endregion
sens_de_B : 0
sens_de_C : 0
pstart_header
    if smachine = "CMS_ANTARES_2615", type_machine = 1
    if type_machine = 1,    
	[
		combinaison_axes = 2 #1=AC 2=BC
		gestion_rotation = 1#2=2 composantes 3=3 composantes
		use_plane_spacial = 0 #0=cycle19 1=cycle plane
		bldnxtool$ = 1 #0=pas d'outil suivant 1=preparation outil suivant
		use_name_tool = no$ # appel des outil par leur nom
		mode_deg = 1 #1=Z 2=ZetY 3=ZetXY
		maxiab = 121.01
		miniab = -121.01
		maxic = 271.01
		minic =  -271.01
		Vect_porteur_x = 1
		Vect_porteur_y = 0
		Vect_porteur_z = 0
		use_fmax_plane = 1
		sens_de_B = -1
        sens_de_C = 1
	]

    if combinaison_axes = 1,    
	[
		result = nwadrs(slettrea, axeab_reel)
		result = nwadrs(slettrea, axeab_degage_butee)
	]
    if combinaison_axes = 2,    
	[
		result = nwadrs(slettreb, axeab_reel)
		result = nwadrs(slettreb, axeab_degage_butee)
	]
	n$, "(DIS,", 34,smcname$, 34, ")", e$
pend_header
	n$, ";(    -     ) ",e$
	n$, ";( PROGRAMME", smachine, ":", sprogname$, ")", e$
	n$, ";( PROGRAMME PAR       LE ", date$, " A ", time$,"  )", e$
	n$, "; ------------------------", e$
	n$, " " ,e$
	n$, "; ----- LISTE OUTIL ------", e$
    #"coucou fin debut", e$
fmt 2 pendolo
	
pstart_posf
	n$, " " ,e$
	pendolo = mi5$
	if pendolo = 0, n$, "(UOT,1,X0,Y0,Z0)", e$
   	n$, "(GTO,START,@KEY1=0)", e$
   	n$, "(GTO,?SC0.4)", e$
	spaces$ = 0
	n$, 34,"START",34, e$
	spaces$ = 1	
	#result = mprint(sbutee1,2)
	if mr9$ = 1,	[
					n$, "M124", e$
					n$, "M0", e$
					n$, "M114", e$
					]
	#result = mprint(sbutee2,2)
	if mr10$ = 1,	[
					n$, "M123", e$
					n$, "M0", e$
					n$, "M113", e$
					]
	#n$, "G90 G17 G40 G0 G94 " ,e$
	n$, sannul_plan, e$ #"CYCLE800()" ,e$
	#if t$ = 14,	
	#[
	if simu <> 1,
	[
		"((IF@U1CUTC = 14)" ,e$
		n$, "G0 G79 Z-350", e$
		n$, "M33 ;Debloquer Axe C" ,e$
		n$, "M31 ;Debloquer Axe B" ,e$
		axec_reel = 0, axeab_reel = 0	
		gcode$ = 1
		fr_pos$ = avanceG0					
		n$, sgcode, *axec_reel, *axeab_reel, pavance, e$
		gcode$ = 0
		"(ENDIF)" ,e$
	]
	#]
	n$, "G0 G79 Z0." ,e$ #n$, "G0 G79 Z0. D0" ,e$
	if pendolo = 0, n$, "G0 G79 X0 Y0", e$
	#n$, "D1" ,e$
	if t$ <> 14,	[
					n$, "M33 ;Debloquer Axe C" ,e$
					n$, "M31 ;Debloquer Axe B" ,e$
					]
    axec_reel = 0, axeab_reel = 0	
	gcode$ = 1
	fr_pos$ = avanceG0					
	n$, sgcode, *axec_reel, *axeab_reel, pavance, e$
	gcode$ = 0
    #"debut du debut", e$
pend_psof
	 ##pappel_origine
	#if simu <> 1,n$, "GOTOF SAUT1" ,e$
	" " ,e$
    #"fin du debut", e$
    old_ss = ss$
pstart_ptlchg
    #"je commence le changement d'outil", e$
pstart_outil_ptlchg
    tloffno$ = 1
    n$, "(DIS,", 34, *strtool$, 34, ")", e$
    #n$, "STOPRE", e$
pend_outil_ptlchg

pend_ptlchg
    #"je fini mon changement d'outil", e$
    old_ss = ss$
pstart_between_path_ptlchg0
    #"je change de passe" e$
pstart_between_op_ptlchg0
    #"je change d'op sans changer d'outil", e$
pend_ptlchg0
    if old_ss <> ss$ ,n$, "M3" , *ss$ ,e$
    old_ss = ss$
    #"j'ai fini mon ptlchg0", e$
pstart_peof
    #"debut de la fin", e$
pend_peof 
    if type_machine = 1,    
	[
		if pendolo = 0, mode_deg = 3
		pdegage
		n$, splane_reset_stay, e$
		axeab_reel = 0
		axec_reel = 0
		gcode$  = 0
		n$, sgcode, *axeab_reel, *axec_reel, e$
	]
    #"fin de la fin", e$
pparameter$
    #~prmcode$, "=", sparameter$, e$                # pour afficher tous les parametres
    if prmcode$ = 10030, av_travail = rpar(sparameter$, 1)
    if prmcode$ = 10031, av_plonge = rpar(sparameter$, 1)
    if prmcode$ = 15140, av_retract = rpar(sparameter$, 1)
    if prmcode$ = 15101, use_retract_plane = rpar(sparameter$, 1)
    if prmcode$ = 15100, use_secu_plane = rpar(sparameter$, 1)
    if prmcode$ = 15339, use_secu_start_end = rpar(sparameter$, 1)
    if prmcode$ = 10024, feed_plane = rpar(sparameter$, 1)
    if prmcode$ = 15374, retract_plane = rpar(sparameter$, 1)
    if prmcode$ = 10020, secu_plane = rpar(sparameter$, 1)
    if prmcode$ = 10027, garde_plane = rpar(sparameter$, 1)
    if prmcode$ = 20004, paramT1  = rpar(sparameter$, 16)
    if prmcode$ = 20007, paramT20 = rpar(sparameter$, 11)
	if prmcode$ = 15887, safety_zone = rpar(sparameter$, 1)
pwrttparam$ # lire les parametres des outils
    if prmcode$ = 20004, paramT1  = rpar(sparameter$, 16)
    if prmcode$ = 20007, paramT20 = rpar(sparameter$, 11)
#pwrtt$      # Lite des outil
   # strtool$ = ucase(strtool$)
  #  if t$ > 0, n$, ";" *paramT1, *stypeT, *paramT5, ptypeBoutT , pangleT , phauteurT , *strtool$, e$
#region Gestion_outil_parm
fmt "QS" 4 compt_out
fmt 1 numpas
sblanc : " "
sdesioutil : ""
sdefoutil : ""
snomoutil : ""
pwrtt$      # Liste des outils
    if t$ > 0,
	[
		snomoutil = ucase(strtool$)
		spaces$ = 0
		compt_out = t$
		sdesioutil = snomoutil 
		n$, " ;" *t$ ," ", 34, *strtool$, 34, e$
		outil_util = outil_util  + 1
		plistdesoutil
		spaces$ = 1
	]
plistdesoutil   # memorisation des outil a venir pour tool def "non_prochain_outil"
				
	if outil_util = 1, sdesioutil_1 = sdesioutil , outil_broche1 = t$
	if outil_util = 2, sdesioutil_2 = sdesioutil , outil_broche2 = t$
	if outil_util = 3, sdesioutil_3 = sdesioutil , outil_broche3 = t$
	if outil_util = 4, sdesioutil_4 = sdesioutil , outil_broche4 = t$
	if outil_util = 5, sdesioutil_5 = sdesioutil , outil_broche5 = t$
	if outil_util = 6, sdesioutil_6 = sdesioutil , outil_broche6 = t$
	if outil_util = 7, sdesioutil_7 = sdesioutil , outil_broche7 = t$
	if outil_util = 8, sdesioutil_8 = sdesioutil , outil_broche8 = t$
	if outil_util = 9, sdesioutil_9 = sdesioutil , outil_broche9 = t$
	if outil_util = 10, sdesioutil_10 = sdesioutil , outil_broche10 = t$
	if outil_util = 11, sdesioutil_11 = sdesioutil , outil_broche11 = t$
	if outil_util = 12, sdesioutil_12 = sdesioutil , outil_broche12 = t$
	if outil_util = 13, sdesioutil_13 = sdesioutil , outil_broche13 = t$
	if outil_util = 14, sdesioutil_14 = sdesioutil , outil_broche14 = t$
	if outil_util = 15, sdesioutil_15 = sdesioutil, outil_broche15 = t$
	if outil_util = 16, sdesioutil_16 = sdesioutil, outil_broche16 = t$
	if outil_util = 17, sdesioutil_17 = sdesioutil, outil_broche17 = t$
	if outil_util = 18, sdesioutil_18 = sdesioutil, outil_broche18 = t$
	if outil_util = 19, sdesioutil_19 = sdesioutil, outil_broche19 = t$
	if outil_util = 20, sdesioutil_20 = sdesioutil, outil_broche20 = t$
	if outil_util = 21, sdesioutil_21 = sdesioutil, outil_broche21 = t$
	if outil_util = 22, sdesioutil_22 = sdesioutil, outil_broche22 = t$
	if outil_util = 23, sdesioutil_23 = sdesioutil, outil_broche23 = t$
	if outil_util = 24, sdesioutil_24 = sdesioutil, outil_broche24 = t$
	if outil_util = 25, sdesioutil_25 = sdesioutil, outil_broche25 = t$
	if outil_util = 26, sdesioutil_26 = sdesioutil, outil_broche26 = t$
	if outil_util = 27, sdesioutil_27 = sdesioutil, outil_broche27 = t$
	if outil_util = 28, sdesioutil_28 = sdesioutil, outil_broche28 = t$
	if outil_util = 29, sdesioutil_29 = sdesioutil, outil_broche29 = t$
	if outil_util = 30, sdesioutil_30 = sdesioutil, outil_broche30 = t$
					
paffichenext_tool   # memorisation des outil a venir pour tool def "non_prochain_outil"
	if next_tool$ = outil_broche1, sdesioutil_1 
	if next_tool$ = outil_broche2, sdesioutil_2 
	if next_tool$ = outil_broche3, sdesioutil_3 
	if next_tool$ = outil_broche4, sdesioutil_4 
	if next_tool$ = outil_broche5, sdesioutil_5 
	if next_tool$ = outil_broche6, sdesioutil_6 
	if next_tool$ = outil_broche7, sdesioutil_7 
	if next_tool$ = outil_broche8, sdesioutil_8 
	if next_tool$ = outil_broche9, sdesioutil_9 
	if next_tool$ = outil_broche10, sdesioutil_10 
	if next_tool$ = outil_broche11, sdesioutil_11 
	if next_tool$ = outil_broche12, sdesioutil_12 
	if next_tool$ = outil_broche13, sdesioutil_13 
	if next_tool$ = outil_broche14, sdesioutil_14 
	if next_tool$ = outil_broche15, sdesioutil_15 
	if next_tool$ = outil_broche16, sdesioutil_16 
	if next_tool$ = outil_broche17, sdesioutil_17 
	if next_tool$ = outil_broche18, sdesioutil_18 
	if next_tool$ = outil_broche19, sdesioutil_19 
	if next_tool$ = outil_broche20, sdesioutil_20 
	if next_tool$ = outil_broche21, sdesioutil_21 
	if next_tool$ = outil_broche22, sdesioutil_22 
	if next_tool$ = outil_broche23, sdesioutil_23 
	if next_tool$ = outil_broche24, sdesioutil_24 
	if next_tool$ = outil_broche25, sdesioutil_25 
	if next_tool$ = outil_broche26, sdesioutil_26 
	if next_tool$ = outil_broche27, sdesioutil_27 
	if next_tool$ = outil_broche28, sdesioutil_28 
	if next_tool$ = outil_broche29, sdesioutil_29 
	if next_tool$ = outil_broche30, sdesioutil_30 

paff_tooll_change
	if t$ = outil_broche1, sdesioutil_1 
	if t$ = outil_broche2, sdesioutil_2 
	if t$ = outil_broche3, sdesioutil_3 
	if t$ = outil_broche4, sdesioutil_4 
	if t$ = outil_broche5, sdesioutil_5 
	if t$ = outil_broche6, sdesioutil_6 
	if t$ = outil_broche7, sdesioutil_7 
	if t$ = outil_broche8, sdesioutil_8 
	if t$ = outil_broche9, sdesioutil_9 
	if t$ = outil_broche10, sdesioutil_10 
	if t$ = outil_broche11, sdesioutil_11 
	if t$ = outil_broche12, sdesioutil_12 
	if t$ = outil_broche13, sdesioutil_13 
	if t$ = outil_broche14, sdesioutil_14 
	if t$ = outil_broche15, sdesioutil_15 
	if t$ = outil_broche16, sdesioutil_16 
	if t$ = outil_broche17, sdesioutil_17 
	if t$ = outil_broche18, sdesioutil_18 
	if t$ = outil_broche19, sdesioutil_19 
	if t$ = outil_broche20, sdesioutil_20 
	if t$ = outil_broche21, sdesioutil_21 
	if t$ = outil_broche22, sdesioutil_22 
	if t$ = outil_broche23, sdesioutil_23 
	if t$ = outil_broche24, sdesioutil_24 
	if t$ = outil_broche25, sdesioutil_25 
	if t$ = outil_broche26, sdesioutil_26 
	if t$ = outil_broche27, sdesioutil_27 
	if t$ = outil_broche28, sdesioutil_28 
	if t$ = outil_broche29, sdesioutil_29 
	if t$ = outil_broche30, sdesioutil_30 


					
# variable outil
fmt "" 2 outil_util
fmt "" 2 outil_broche1
fmt "" 2 outil_broche2
fmt "" 2 outil_broche3
fmt "" 2 outil_broche4
fmt "" 2 outil_broche5
fmt "" 2 outil_broche6
fmt "" 2 outil_broche7
fmt "" 2 outil_broche8
fmt "" 2 outil_broche9
fmt "" 2 outil_broche10
fmt "" 2 outil_broche11
fmt "" 2 outil_broche12
fmt "" 2 outil_broche13
fmt "" 2 outil_broche14
fmt "" 2 outil_broche15
fmt "" 2 outil_broche16
fmt "" 2 outil_broche17
fmt "" 2 outil_broche18
fmt "" 2 outil_broche19
fmt "" 2 outil_broche20
fmt "" 2 outil_broche21
fmt "" 2 outil_broche22
fmt "" 2 outil_broche23
fmt "" 2 outil_broche24
fmt "" 2 outil_broche25
fmt "" 2 outil_broche26
fmt "" 2 outil_broche27
fmt "" 2 outil_broche28
fmt "" 2 outil_broche29
fmt "" 2 outil_broche30					
sdesioutil_1 : ""
sdesioutil_2  : ""
sdesioutil_3 : ""
sdesioutil_4 : ""
sdesioutil_5 : ""
sdesioutil_6 : ""
sdesioutil_7 : ""
sdesioutil_8 : "" 
sdesioutil_9 : ""
sdesioutil_10 : ""
sdesioutil_11 : ""
sdesioutil_12 : ""
sdesioutil_13 : ""
sdesioutil_14 : ""
sdesioutil_15 : ""
sdesioutil_16 : ""
sdesioutil_17 : ""
sdesioutil_18 : ""
sdesioutil_19 : ""
sdesioutil_20 : ""
sdesioutil_21 : ""
sdesioutil_22 : ""
sdesioutil_23 : ""
sdesioutil_24 : ""
sdesioutil_25 : ""
sdesioutil_26 : ""
sdesioutil_27 : ""
sdesioutil_28 : ""
sdesioutil_29 : ""
sdesioutil_30 : ""
sdesioutil_31 : ""
sdesioutil_32 : ""
sdesioutil_33 : ""
sdesioutil_34 : ""
sdesioutil_35 : ""
sdesioutil_36 : ""
sdesioutil_37 : ""
sdesioutil_38 : ""
sdesioutil_39 : ""
sdesioutil_40 : ""
sdesioutil_41 : ""
sdesioutil_42 : ""
sdesioutil_43 : ""
sdesioutil_44 : ""
sdesioutil_45 : ""
sdesioutil_46 : ""
sdesioutil_47 : ""
sdesioutil_48 : ""
sdesioutil_49 : ""
sdesioutil_50 : ""
sdesioutil_51 : ""
sdesioutil_52 : ""
sdesioutil_53 : ""
sdesioutil_54 : ""
sdesioutil_55 : ""
sdesioutil_56 : ""
sdesioutil_57 : ""
sdesioutil_58 : ""
sdesioutil_59 : ""
sdesioutil_60 : ""
sdesioutil_61 : ""
sdesioutil_62 : ""
sdesioutil_63 : ""
sdesioutil_64 : ""
sdesioutil_65 : ""
sdesioutil_66 : ""
sdesioutil_67 : ""
sdesioutil_68 : ""
sdesioutil_69 : ""
sdesioutil_70 : ""
sdesioutil_71 : ""
sdesioutil_72 : ""
sdesioutil_73 : ""
sdesioutil_74 : ""
sdesioutil_75 : ""
sdesioutil_76 : ""
sdesioutil_77 : ""
sdesioutil_78 : ""
sdesioutil_79 : ""
sdesioutil_80 : ""
sdesioutil_81 : ""
sdesioutil_82 : ""
sdesioutil_83 : ""
sdesioutil_84 : ""
sdesioutil_85 : ""
sdesioutil_86 : ""
sdesioutil_87 : ""
sdesioutil_88 : ""
sdesioutil_89 : ""
sdesioutil_90 : ""
sdesioutil_91 : ""
sdesioutil_92 : ""
sdesioutil_93 : ""
sdesioutil_94 : ""
sdesioutil_95 : ""
sdesioutil_96 : ""
sdesioutil_97 : ""
sdesioutil_98 : ""
sdesioutil_99 : ""
sdesioutil_100 : ""
#endregion
	

strtool_v7$ : 2
fmt "T" 8 paramT1    # N� outil
fmt   10 paramT2      # Type d'outil
fmt   10 paramT3      # Matiere de l'outil 1=Rapide 2=carbure 3=carbure revetu 4=cermet 5=borzon
fmt   10 paramT4      # Type de rayon de bout 0=aucun 1=torique 2=spherique
fmt "D=" 10 paramT5   # Diametre
fmt "R=" 10 paramT6   # Rayon de bout
fmt   10 paramT7      # Nombre de filet par mm
fmt "A=" 10 paramT8   # Angle de bout
fmt   10 paramT9      # NÃƒâ€šÃ‚Â° de correcteur de rayon
fmt   10 paramT10     # NÃƒâ€šÃ‚Â° de correcteur de longeur
fmt   10 paramT11     # Avance travail
fmt   10 paramT12     # Avance plongee
fmt   10 paramT13     # Avance retraction
fmt   10 paramT14     # Vitesse de broche
fmt   10 paramT15     # Type de lubrification 0=arret 1=eau 2=air 3=broche 4=les 2
fmt   8 paramT16     # Nombre de dents
fmt   10 paramT20     # DiamÃƒÆ’Ã‚Â¨tre pilote
fmt   "EP=" 10 paramT21     # Hauteur de coupe
fmt   10 paramT22     # Hauteur de sortie totale
fmt   10 paramT23     # Hauteur helice
fmt   10 paramT24     # Diametre de queue
fmt   10 paramT25     # Diametre porte-outil
fmt   10 paramT26     # Hauteur porte-outil
fmt   10 paramT27     # 0=sens horaire 1=sens horaire
fmt   10 paramT28     # % de la vitesse de coupe
fmt   10 paramT29     # % de l'avance par dent
fmt   4 paramT30     # 0=pouces 1=metrique
stypT00 : "OUTIL SPECIAL"
stypT01 : "FORET A CENTRER"
stypT02 : "FORET A NOYER"
stypT03 : "FORET"
stypT04 : "TARAUD A DROITE"
stypT05 : "TARAUD A GAUCHE"
stypT06 : "ALESOIR"
stypT07 : "BARRE D'ALESAGE"
stypT08 : "FRAISE A LAMER"
stypT09 : ""
stypT10 : "FRAISE 2 TAILLES"
stypT11 : "FRAISE BOULE"
stypT12 : "FRAISE A CHANFREINER"
stypT13 : "TOURTEAU"
stypT14 : "FRAISE 3 TAILLES"
stypT15 : "FRAISE A RAYON"
stypT16 : "FRAISE QUEUE D'ARONDE"
stypT17 : "FRAISE CONIQUE"
stypT18 : "FRAISE SPHERIQUE"
stypT19 : "FRAISE TORIQUE"
stypeT : ""
fstrsel stypT00 paramT2 stypeT 20 -1
smatT1  : "ACIER RAPIDE"
smatT2  : "CARBURE"
smatT3  : "CARBURE REVETU"
smatT4  : "CERMET"
smatT5  : "BORZON"
smatT6  : "BORZON"
smatT7  : "BORZON"
smatT8  : "BORZON"
smatT9  : "BORZON"
smatT10 : "INCONNU"
smatT : ""
fstrsel smatT1 paramT3 smatT 10 -1

ptypeBoutT # afficher on non le rayon de bout
    if paramT4 <> 0, paramT6
pangleT    # afficher on non l'angle de l'outil
    if paramT2 = 3 | paramT2 = 12 | paramT2 = 17, paramT8
phauteurT  # afficher la hauteur de dent pour une fraise 3 tailles
    if paramT2 = 14, paramT21
pcomment$
    scomm$ = ucase(scomm$)
    if gcode$ = 1005, n$, "(DIS,",34, scomm$,34,")",e$
    if gcode$ = 1006, n$, scomm$,e$
    if gcode$ = 1007, n$, "(DIS,",34, scomm$,34,")",e$
    if gcode$ = 1008, n$, "(DIS,",34, scomm$,34,")",e$
#region texte_pp
[CTRL_TEXT_XML_BEGIN]
<?xml version="1.0" encoding="UTF-8"?>
<mp_xml_post_text xml:space="preserve">
	<control>
		<control_label>CTRL_ROUTER|CMS_AVANT_PX5</control_label>
		<language>fr-FR</language>
		<misc_integers>
			<misc_1>
				<text>Sens B (0= positif /1=negatif)</text>
			</misc_1>
			<misc_2>
				<text>ajout 360 sur C (+1 =+360 / -1 =-360)</text>
			</misc_2>
			<misc_3>
				<text>Reinitialise les axes entre passe (1=oui / 0=non)</text>
				<inch_value>1.</inch_value>
				<metric_value>1.</metric_value>
			</misc_3>
			<misc_4>
				<text>Valeur de C a B0</text>
			</misc_4>
			<misc_5>
				<text>MODE PENDOLO 0=NON 1=OUI</text>
			</misc_5>
			<misc_6>
				<text>""</text>
			</misc_6>
			<misc_7>
				<text>""</text>
			</misc_7>
			<misc_8>
				<text>""</text>
			</misc_8>
			<misc_9>
				<text>""</text>
			</misc_9>
			<misc_10>
				<text>VALEUR AVANCE RAPIDE</text>
				<inch_value>10000.</inch_value>
				<metric_value>10000.</metric_value>
			</misc_10>
		</misc_integers>
		<misc_reals>
			<misc_1>
				<text>VALEUR DE DEGAGEMENT VECTORIELLE</text>
			</misc_1>
			<misc_2>
				<text>""</text>
			</misc_2>
			<misc_3>
				<text>""</text>
			</misc_3>
			<misc_4>
				<text>""</text>
			</misc_4>
			<misc_5>
				<text>""</text>
			</misc_5>
			<misc_6>
				<text>""</text>
			</misc_6>
			<misc_7>
				<text>""</text>
			</misc_7>
			<misc_8>
				<text>CYCLE DE LISSAGE 1 =eb - 2=1/2 fin 3= fin</text>
				<inch_value>3.</inch_value>
				<metric_value>3.</metric_value>
			</misc_8>
			<misc_9>
				<text>UTILISATION DES BUTEES MACHINE GAUCHE</text>
			</misc_9>
			<misc_10>
				<text>UTILISATION DES BUTEES MACHINE DROITE</text>
			</misc_10>
		</misc_reals>
		<simple_drill>
			<description>
				<text>pointage/percage/lamage</text>
			</description>
			<feed_rate>
				<text>Avance</text>
			</feed_rate>
			<dwell>
				<text>Tempo.</text>
			</dwell>
			<clearance>
				<text>Plan de securite</text>
			</clearance>
			<retract>
				<text>Garde</text>
			</retract>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
			<shift>
				<text>""</text>
			</shift>
		</simple_drill>
		<peck_drill>
			<description>
				<text>debourage</text>
			</description>
			<feed_rate>
				<text>Avance</text>
			</feed_rate>
			<dwell>
				<text>Tempo.</text>
			</dwell>
			<clearance>
				<text>Plan de securite</text>
			</clearance>
			<retract>
				<text>Garde</text>
			</retract>
			<first_peck>
				<text>Increment</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>Remontee</text>
			</retract_amount>
			<shift>
				<text>Prof de passe mini</text>
			</shift>
		</peck_drill>
		<chip_break>
			<description>
				<text>cycle brise copeaux</text>
			</description>
			<feed_rate>
				<text>Avance</text>
			</feed_rate>
			<dwell>
				<text>Tempo.</text>
			</dwell>
			<clearance>
				<text>Plan de securite</text>
			</clearance>
			<retract>
				<text>Garde</text>
			</retract>
			<first_peck>
				<text>Increment</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
			<shift>
				<text>""</text>
			</shift>
		</chip_break>
		<tap>
			<description>
				<text>cycle taraudage</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>Tempo.</text>
			</dwell>
			<clearance>
				<text>Plan de securite</text>
			</clearance>
			<retract>
				<text>Garde</text>
			</retract>
			<first_peck>
				<text>Increment</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
			<shift>
				<text>""</text>
			</shift>
		</tap>
		<bore1>
			<description>
				<text>cycle alesage a l'alesoir</text>
			</description>
			<feed_rate>
				<text>Avance</text>
			</feed_rate>
			<dwell>
				<text>Tempo.</text>
			</dwell>
			<clearance>
				<text>Plan de securite</text>
			</clearance>
			<retract>
				<text>Garde</text>
			</retract>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
			<shift>
				<text>""</text>
			</shift>
		</bore1>
		<bore2>
			<description>
				<text>cycle alesage a la barre</text>
			</description>
			<feed_rate>
				<text>Avance</text>
			</feed_rate>
			<dwell>
				<text>Tempo.</text>
			</dwell>
			<clearance>
				<text>Plan de securite</text>
			</clearance>
			<retract>
				<text>Garde</text>
			</retract>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>Orientation</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
			<shift>
				<text>Degagement</text>
			</shift>
		</bore2>
		<misc1>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</misc1>
		<misc2>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</misc2>
		<drill_cycle_9>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_9>
		<drill_cycle_10>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_10>
		<drill_cycle_11>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_11>
		<drill_cycle_12>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_12>
		<drill_cycle_13>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_13>
		<drill_cycle_14>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_14>
		<drill_cycle_15>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_15>
		<drill_cycle_16>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_16>
		<drill_cycle_17>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_17>
		<drill_cycle_18>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_18>
		<drill_cycle_19>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_19>
		<drill_cycle_20>
			<description>
				<text>""</text>
			</description>
			<feed_rate>
				<text>""</text>
			</feed_rate>
			<dwell>
				<text>""</text>
			</dwell>
			<clearance>
				<text>""</text>
			</clearance>
			<retract>
				<text>""</text>
			</retract>
			<depth>
				<text>""</text>
			</depth>
			<first_peck>
				<text>""</text>
			</first_peck>
			<subsequent_peck>
				<text>""</text>
			</subsequent_peck>
			<peck_clearance>
				<text>""</text>
			</peck_clearance>
			<retract_amount>
				<text>""</text>
			</retract_amount>
		</drill_cycle_20>
		<simple_drill_custom_parameters>
			<description>
				<text>Parametres de cycle special 1</text>
			</description>
		</simple_drill_custom_parameters>
		<peck_drill_custom_parameters>
			<description>
				<text>Parametres de cycle special 2</text>
			</description>
		</peck_drill_custom_parameters>
		<chip_break_drill_custom_parameters>
			<description>
				<text>Parametres de cycle special 3</text>
			</description>
		</chip_break_drill_custom_parameters>
		<tap_custom_parameters>
			<description>
				<text>Parametres de cycle special 4</text>
			</description>
		</tap_custom_parameters>
		<bore1_custom_parameters>
			<description>
				<text>Parametres de cycle special 5</text>
			</description>
		</bore1_custom_parameters>
		<bore2_custom_parameters>
			<description>
				<text>Parametres de cycle special 6</text>
			</description>
		</bore2_custom_parameters>
		<misc1_custom_parameters>
			<description>
				<text>Parametres de cycle special 7</text>
			</description>
		</misc1_custom_parameters>
		<misc2_custom_parameters>
			<description>
				<text>Parametres de cycle special 8</text>
			</description>
		</misc2_custom_parameters>
		<drill_cycle_9_custom_parameters>
			<description>
				<text>Parametres de cycle special 9</text>
			</description>
		</drill_cycle_9_custom_parameters>
		<drill_cycle_10_custom_parameters>
			<description>
				<text>Parametres de cycle special 10</text>
			</description>
		</drill_cycle_10_custom_parameters>
		<drill_cycle_11_custom_parameters>
			<description>
				<text>Parametres de cycle special 11</text>
			</description>
		</drill_cycle_11_custom_parameters>
		<drill_cycle_12_custom_parameters>
			<description>
				<text>Parametres de cycle special 12</text>
			</description>
		</drill_cycle_12_custom_parameters>
		<drill_cycle_13_custom_parameters>
			<description>
				<text>Parametres de cycle special 13</text>
			</description>
		</drill_cycle_13_custom_parameters>
		<drill_cycle_14_custom_parameters>
			<description>
				<text>Parametres de cycle special 14</text>
			</description>
		</drill_cycle_14_custom_parameters>
		<drill_cycle_15_custom_parameters>
			<description>
				<text>Parametres de cycle special 15</text>
			</description>
		</drill_cycle_15_custom_parameters>
		<drill_cycle_16_custom_parameters>
			<description>
				<text>Parametres de cycle special 16</text>
			</description>
		</drill_cycle_16_custom_parameters>
		<drill_cycle_17_custom_parameters>
			<description>
				<text>Parametres de cycle special 17</text>
			</description>
		</drill_cycle_17_custom_parameters>
		<drill_cycle_18_custom_parameters>
			<description>
				<text>Parametres de cycle special 18</text>
			</description>
		</drill_cycle_18_custom_parameters>
		<drill_cycle_19_custom_parameters>
			<description>
				<text>Parametres de cycle special 19</text>
			</description>
		</drill_cycle_19_custom_parameters>
		<drill_cycle_20_custom_parameters>
			<description>
				<text>Parametres de cycle special 20</text>
			</description>
		</drill_cycle_20_custom_parameters>
		<drill_cycle_descriptions>
			<simple_drill>
				<text>Pereage</text>
			</simple_drill>
			<peck_drill>
				<text>Debourrage</text>
			</peck_drill>
			<chip_break>
				<text>Brise copeaux</text>
			</chip_break>
			<tapping>
				<text>Taraudage</text>
			</tapping>
			<boring_1>
				<text>Alesage alesoir</text>
			</boring_1>
			<boring_2>
				<text>Alesage bare</text>
			</boring_2>
			<misc_drill_1>
				<text>Taraudage brise-cop</text>
			</misc_drill_1>
			<misc_drill_2>
				<text>""</text>
			</misc_drill_2>
			<custom_drill_9>
				<text>""</text>
			</custom_drill_9>
			<custom_drill_10>
				<text>""</text>
			</custom_drill_10>
			<custom_drill_11>
				<text>""</text>
			</custom_drill_11>
			<custom_drill_12>
				<text>""</text>
			</custom_drill_12>
			<custom_drill_13>
				<text>""</text>
			</custom_drill_13>
			<custom_drill_14>
				<text>""</text>
			</custom_drill_14>
			<custom_drill_15>
				<text>""</text>
			</custom_drill_15>
			<custom_drill_16>
				<text>""</text>
			</custom_drill_16>
			<custom_drill_17>
				<text>""</text>
			</custom_drill_17>
			<custom_drill_18>
				<text>""</text>
			</custom_drill_18>
			<custom_drill_19>
				<text>""</text>
			</custom_drill_19>
			<custom_drill_20>
				<text>""</text>
			</custom_drill_20>
		</drill_cycle_descriptions>
		<canned_text>
			<canned_text_1>
				<text>""</text>
			</canned_text_1>
			<canned_text_2>
				<text>""</text>
			</canned_text_2>
			<canned_text_3>
				<text>""</text>
			</canned_text_3>
			<canned_text_4>
				<text>""</text>
			</canned_text_4>
			<canned_text_5>
				<text>""</text>
			</canned_text_5>
			<canned_text_6>
				<text>""</text>
			</canned_text_6>
			<canned_text_7>
				<text>""</text>
			</canned_text_7>
			<canned_text_8>
				<text>""</text>
			</canned_text_8>
			<canned_text_9>
				<text>""</text>
			</canned_text_9>
			<canned_text_10>
				<text>""</text>
			</canned_text_10>
		</canned_text>
		<tool_parameters>
			<head_number>
				<text>""</text>
			</head_number>
			<length_offset>
				<text>""</text>
			</length_offset>
			<diameter_offset>
				<text>""</text>
			</diameter_offset>
			<canned_text>
				<text>""</text>
			</canned_text>
		</tool_parameters>
	</control>
</mp_xml_post_text>
[CTRL_TEXT_XML_END]
#endregion
