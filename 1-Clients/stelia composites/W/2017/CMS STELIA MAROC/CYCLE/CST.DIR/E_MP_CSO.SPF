PROC E_MP_CSO(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_CPA,REAL S_CPO,REAL S_STA1,REAL S_INCA,INT S_NMSP,STRING[32] S_TNAME,REAL S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 04.05.65.00 ;DATE: 2014-10-22
;CHANGE : 04.05.51.00 ;DATE: 2013-08-21
;ShopMill: Measure part: Circle segment outside
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ
DEF REAL _FAK1,_FAK2,_SD,_SD1,_SD2,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(SUBSTR($P_PROG[0],3,11)=="MA_JOG_STEP")OR(SUBSTR($P_PROG[1],3,11)=="MA_JOG_STEP")
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
IF(($P_TOOL>1)AND($P_TOOLNO))
_SD2=$P_TOOLL[1]
_SD1=$TC_DP3[$P_TOOLNO,1]+$TC_DP12[$P_TOOLNO,1]+$TC_DP21[$P_TOOLNO,1]
IF(_SD2<_SD1)
_SD=(_SD1-_SD2)*_FAK1/$P_ACTFRAME[_ZZ,SC]
ELSE
_SD=0
ENDIF
ELSE
_SD=0
ENDIF
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($P_SIM)
N979 CYCLE979(S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_FA,S_TSA,S_CPA,S_CPO,S_STA1,S_INCA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
_RETS:
RET
